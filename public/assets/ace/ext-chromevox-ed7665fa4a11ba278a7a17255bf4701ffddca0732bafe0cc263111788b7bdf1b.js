define("ace/ext/chromevox",["require","exports","module","ace/editor","ace/config"],function(e){function t(){return"undefined"!=typeof cvox&&cvox&&cvox.Api}function i(e){if(t())me(e);else{if(pe++,pe>=Ae)return;window.setTimeout(i,500,e)}}var n={};n.SpeechProperty,n.Cursor,n.Token,n.Annotation;var s={rate:.8,pitch:.4,volume:.9},o={rate:1,pitch:.5,volume:.9},r={rate:.8,pitch:.8,volume:.9},a={rate:.8,pitch:.3,volume:.9},l={rate:.8,pitch:.7,volume:.9},h={rate:.8,pitch:.8,volume:.9},c={punctuationEcho:"none",relativePitch:-.6},u="ALERT_NONMODAL",d="ALERT_MODAL",g="INVALID_KEYPRESS",f="insertMode",m="start",p=[{substr:";",newSubstr:" semicolon "},{substr:":",newSubstr:" colon "}],A={SPEAK_ANNOT:"annots",SPEAK_ALL_ANNOTS:"all_annots",TOGGLE_LOCATION:"toggle_location",SPEAK_MODE:"mode",SPEAK_ROW_COL:"row_col",TOGGLE_DISPLACEMENT:"toggle_displacement",FOCUS_TEXT:"focus_text"},v="CONTROL + SHIFT ";n.editor=null;var C=null,F={},w=!1,E=!1,b=!1,y=null,$={},B={},D=function(e){return v+String.fromCharCode(e)},S=function(){var e=n.editor.keyBinding.getKeyboardHandler();return"ace/keyboard/vim"===e.$id},k=function(e){return n.editor.getSession().getTokenAt(e.row,e.column+1)},x=function(e){return n.editor.getSession().getLine(e.row)},L=function(e){F[e.row]&&cvox.Api.playEarcon(u),w?(cvox.Api.stop(),V(e),H(k(e)),P(e.row,1)):P(e.row,0)},R=function(e){var t=x(e),i=t.substr(e.column-1);0===e.column&&(i=" "+t);var n=/^\W(\w+)/,s=n.exec(i);return null!==s},T={constant:{prop:s},entity:{prop:r},keyword:{prop:a},storage:{prop:l},variable:{prop:h},meta:{prop:o,replace:[{substr:"</",newSubstr:" closing tag "},{substr:"/>",newSubstr:" close tag "},{substr:"<",newSubstr:" tag start "},{substr:">",newSubstr:" tag end "}]}},M={prop:M},_=function(e,t){for(var i=e,n=0;n<t.length;n++){var s=t[n],o=new RegExp(s.substr,"g");i=i.replace(o,s.newSubstr)}return i},O=function(e,t,i){var n={};n.value="",n.type=e[t].type;for(var s=t;i>s;s++)n.value+=e[s].value;return n},W=function(e){if(e.length<=1)return e;for(var t=[],i=0,n=1;n<e.length;n++){var s=e[i],o=e[n];N(s)!==N(o)&&(t.push(O(e,i,n)),i=n)}return t.push(O(e,i,e.length)),t},I=function(e){var t=n.editor.getSession().getLine(e),i=/^\s*$/;return null!==i.exec(t)},P=function(e,t){var i=n.editor.getSession().getTokens(e);if(0===i.length||I(e))return void cvox.Api.playEarcon("EDITABLE_TEXT");i=W(i);var s=i[0];i=i.filter(function(e){return e!==s}),z(s,t),i.forEach(H)},H=function(e){z(e,1)},N=function(e){if(e&&e.type){var t=e.type.split(".");if(0!==t.length){var i=t[0],n=T[i];return n?n:M}}},z=function(e,t){var i=N(e),n=_(e.value,p);i.replace&&(n=_(n,i.replace)),cvox.Api.speak(n,t,i.prop)},V=function(e){var t=x(e);cvox.Api.speak(t[e.column],1)},K=function(e,t){var i=x(t),n=i.substring(e.column,t.column);n=n.replace(/ /g," space "),cvox.Api.speak(n)},U=function(e,t){if(1!==Math.abs(e.column-t.column)){var i=x(t).length;if(0===t.column||t.column===i)return void P(t.row,0);if(R(t))return cvox.Api.stop(),void H(k(t))}V(t)},G=function(e,t){n.editor.selection.isEmpty()?E?K(e,t):U(e,t):(K(e,t),cvox.Api.speak("selected",1))},j=function(){if(b)return void(b=!1);var e=n.editor.selection.getCursor();e.row!==C.row?L(e):G(C,e),C=e},q=function(){n.editor.selection.isEmpty()&&cvox.Api.speak("unselected")},Y=function(e){switch(e.action){case"remove":cvox.Api.speak(e.text,0,c),b=!0;break;case"insert":cvox.Api.speak(e.text,0),b=!0}},Q=function(e){var t=e.row,i=e.column;return!F[t]||!F[t][i]},X=function(e){F={};for(var t=0;t<e.length;t++){var i=e[t],n=i.row,s=i.column;F[n]||(F[n]={}),F[n][s]=i}},J=function(){var e=n.editor.getSession().getAnnotations(),t=e.filter(Q);t.length>0&&cvox.Api.playEarcon(u),X(e)},Z=function(e){var t=e.type+" "+e.text+" on "+te(e.row,e.column);t=t.replace(";","semicolon"),cvox.Api.speak(t,1)},ee=function(e){var t=F[e];for(var i in t)Z(t[i])},te=function(e,t){return"row "+(e+1)+" column "+(t+1)},ie=function(){cvox.Api.speak(te(C.row,C.column))},ne=function(){for(var e in F)ee(e)},se=function(){if(S())switch(n.editor.keyBinding.$data.state){case f:cvox.Api.speak("Insert mode");break;case m:cvox.Api.speak("Command mode")}},oe=function(){w=!w,w?cvox.Api.speak("Speak location on row change enabled."):cvox.Api.speak("Speak location on row change disabled.")},re=function(){E=!E,E?cvox.Api.speak("Speak displacement on column changes."):cvox.Api.speak("Speak current character or word on column changes.")},ae=function(e){if(e.ctrlKey&&e.shiftKey){var t=$[e.keyCode];t&&t.func()}},le=function(e,t){if(S()){var i=t.keyBinding.$data.state;if(i!==y){switch(i){case f:cvox.Api.playEarcon(d),cvox.Api.setKeyEcho(!0);break;case m:cvox.Api.playEarcon(d),cvox.Api.setKeyEcho(!1)}y=i}}},he=function(e){var t=e.detail.customCommand,i=B[t];i&&(i.func(),n.editor.focus())},ce=function(){var e=ge.map(function(e){return{desc:e.desc+D(e.keyCode),cmd:e.cmd}}),t=document.querySelector("body");t.setAttribute("contextMenuActions",JSON.stringify(e)),t.addEventListener("ATCustomEvent",he,!0)},ue=function(e){e.match?P(C.row,0):cvox.Api.playEarcon(g)},de=function(){n.editor.focus()},ge=[{keyCode:49,func:function(){ee(C.row)},cmd:A.SPEAK_ANNOT,desc:"Speak annotations on line"},{keyCode:50,func:ne,cmd:A.SPEAK_ALL_ANNOTS,desc:"Speak all annotations"},{keyCode:51,func:se,cmd:A.SPEAK_MODE,desc:"Speak Vim mode"},{keyCode:52,func:oe,cmd:A.TOGGLE_LOCATION,desc:"Toggle speak row location"},{keyCode:53,func:ie,cmd:A.SPEAK_ROW_COL,desc:"Speak row and column"},{keyCode:54,func:re,cmd:A.TOGGLE_DISPLACEMENT,desc:"Toggle speak displacement"},{keyCode:55,func:de,cmd:A.FOCUS_TEXT,desc:"Focus text"}],fe=function(e,t){n.editor=t,t.getSession().selection.on("changeCursor",j),t.getSession().selection.on("changeSelection",q),t.getSession().on("change",Y),t.getSession().on("changeAnnotation",J),t.on("changeStatus",le),t.on("findSearchBox",ue),t.container.addEventListener("keydown",ae),C=t.selection.getCursor()},me=function(e){fe(null,e),ge.forEach(function(e){$[e.keyCode]=e,B[e.cmd]=e}),e.on("focus",fe),S()&&cvox.Api.setKeyEcho(!1),ce()},pe=0,Ae=15,ve=e("../editor").Editor;e("../config").defineOptions(ve.prototype,"editor",{enableChromevoxEnhancements:{set:function(e){e&&i(this)},value:!0}})}),function(){window.require(["ace/ext/chromevox"],function(){})}();