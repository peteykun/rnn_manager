define("ace/keyboard/vim",["require","exports","module","ace/range","ace/lib/event_emitter","ace/lib/dom","ace/lib/oop","ace/lib/keys","ace/lib/event","ace/search","ace/lib/useragent","ace/search_highlight","ace/commands/multi_select_commands","ace/mode/text","ace/multi_select"],function(e,t){"use strict";function n(e){return{row:e.line,column:e.ch}}function i(e){return new St(e.row,e.column)}function o(e){e.setOption("disableInput",!0),e.setOption("showCursorWhenSelecting",!1),yt.signal(e,"vim-mode-change",{mode:"normal"}),e.on("cursorActivity",et),E(e),yt.on(e.getInputField(),"paste",h(e))}function r(e){e.setOption("disableInput",!1),e.off("cursorActivity",et),yt.off(e.getInputField(),"paste",h(e)),e.state.vim=null}function s(e,t){this==yt.keyMap.vim&&yt.rmClass(e.getWrapperElement(),"cm-fat-cursor"),t&&t.attach==a||r(e,!1)}function a(e,t){this==yt.keyMap.vim&&yt.addClass(e.getWrapperElement(),"cm-fat-cursor"),t&&t.attach==a||o(e)}function c(e,t){if(t){var n=l(e);if(!n)return!1;var i=yt.Vim.findKey(t,n);return"function"==typeof i&&yt.signal(t,"vim-keypress",n),i}}function l(e){if("'"==e.charAt(0))return e.charAt(1);var t=e.split(/-(?!$)/),n=t[t.length-1];if(1==t.length&&1==t[0].length)return!1;if(2==t.length&&"Shift"==t[0]&&1==n.length)return!1;for(var i=!1,o=0;o<t.length;o++){var r=t[o];r in $t?t[o]=$t[r]:i=!0,r in Bt&&(t[o]=Bt[r])}return i?(m(n)&&(t[t.length-1]=n.toLowerCase()),"<"+t.join("-")+">"):!1}function h(e){var t=e.state.vim;return t.onPasteFn||(t.onPasteFn=function(){t.insertMode||(e.setCursor(I(e.getCursor(),0,1)),Gt.enterInsertMode(e,{},t))}),t.onPasteFn}function u(e,t){for(var n=[],i=e;e+t>i;i++)n.push(String.fromCharCode(i));return n}function d(e,t){return t>=e.firstLine()&&t<=e.lastLine()}function g(e){return/^[a-z]$/.test(e)}function p(e){return-1!="()[]{}".indexOf(e)}function f(e){return Lt.test(e)}function m(e){return/^[A-Z]$/.test(e)}function v(e){return/^\s*$/.test(e)}function C(e,t){for(var n=0;n<t.length;n++)if(t[n]==e)return!0;return!1}function A(e,t,n,i,o){if(void 0===t&&!o)throw Error("defaultValue is required unless callback is provided");if(n||(n="string"),Pt[e]={type:n,defaultValue:t,callback:o},i)for(var r=0;r<i.length;r++)Pt[i[r]]=Pt[e];t&&b(e,t)}function b(e,t,n,i){var o=Pt[e];i=i||{};var r=i.scope;if(!o)throw Error("Unknown option: "+e);if("boolean"==o.type){if(t&&t!==!0)throw Error("Invalid argument: "+e+"="+t);t!==!1&&(t=!0)}o.callback?("local"!==r&&o.callback(t,void 0),"global"!==r&&n&&o.callback(t,n)):("local"!==r&&(o.value="boolean"==o.type?!!t:t),"global"!==r&&n&&(n.state.vim.options[e]={value:t}))}function w(e,t,n){var i=Pt[e];n=n||{};var o=n.scope;if(!i)throw Error("Unknown option: "+e);{if(!i.callback){var r="global"!==o&&t&&t.state.vim.options[e];return(r||"local"!==o&&i||{}).value}var r=t&&i.callback(void 0,t);if("global"!==o&&void 0!==r)return r;if("local"!==o)return i.callback()}}function y(){this.latestRegister=void 0,this.isPlaying=!1,this.isRecording=!1,this.replaySearchQueries=[],this.onRecordingDone=void 0,this.lastInsertModeChanges=Ht()}function E(e){return e.state.vim||(e.state.vim={inputState:new x,lastEditInputState:void 0,lastEditActionCommand:void 0,lastHPos:-1,lastHSPos:-1,lastMotion:null,marks:{},fakeCursor:null,insertMode:!1,insertModeRepeat:void 0,visualMode:!1,visualLine:!1,visualBlock:!1,lastSelection:null,lastPastedText:null,sel:{},options:{}}),e.state.vim}function F(){Nt={searchQuery:null,searchIsReversed:!1,lastSubstituteReplacePart:void 0,jumpList:Wt(),macroModeState:new y,lastChararacterSearch:{increment:0,forward:!0,selectedCharacter:""},registerController:new B({}),searchHistoryController:new L({}),exCommandHistoryController:new L({})};for(var e in Pt){var t=Pt[e];t.value=t.defaultValue}}function x(){this.prefixRepeat=[],this.motionRepeat=[],this.operator=null,this.operatorArgs=null,this.motion=null,this.motionArgs=null,this.keyBuffer=[],this.registerName=null}function S(e,t){e.state.vim.inputState=new x,yt.signal(e,"vim-command-done",t)}function k(e,t,n){this.clear(),this.keyBuffer=[e||""],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!!t,this.blockwise=!!n}function $(e,t){var n=Nt.registerController.registers[e];if(!e||1!=e.length)throw Error("Register name must be 1 character");n[e]=t,It.push(e)}function B(e){this.registers=e,this.unnamedRegister=e['"']=new k,e["."]=new k,e[":"]=new k,e["/"]=new k}function L(){this.historyBuffer=[],this.iterator,this.initialPrefix=null}function D(e,t){Ut[e]=t}function M(e,t){for(var n=[],i=0;t>i;i++)n.push(e);return n}function _(e,t){jt[e]=t}function R(e,t){Gt[e]=t}function T(e,t,n){var i=Math.min(Math.max(e.firstLine(),t.line),e.lastLine()),o=Y(e,i)-1;o=n?o+1:o;var r=Math.min(Math.max(0,t.ch),o);return St(i,r)}function O(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function I(e,t,n){return"object"==typeof t&&(n=t.ch,t=t.line),St(e.line+t,e.ch+n)}function P(e,t){return{line:t.line-e.line,ch:t.line-e.line}}function W(e,t,n,i){for(var o,r=[],s=[],a=0;a<t.length;a++){var c=t[a];"insert"==n&&"insert"!=c.context||c.context&&c.context!=n||i.operator&&"action"==c.type||!(o=H(e,c.keys))||("partial"==o&&r.push(c),"full"==o&&s.push(c))}return{partial:r.length&&r,full:s.length&&s}}function H(e,t){if("<character>"==t.slice(-11)){var n=t.length-11,i=e.slice(0,n),o=t.slice(0,n);return i==o&&e.length>n?"full":0==o.indexOf(i)?"partial":!1}return e==t?"full":0==t.indexOf(e)?"partial":!1}function N(e){var t=/^.*(<[\w\-]+>)$/.exec(e),n=t?t[1]:e.slice(-1);if(n.length>1)switch(n){case"<CR>":n="\n";break;case"<Space>":n=" "}return n}function z(e,t,n){return function(){for(var i=0;n>i;i++)t(e)}}function K(e){return St(e.line,e.ch)}function V(e,t){return e.ch==t.ch&&e.line==t.line}function U(e,t){return e.line<t.line?!0:e.line==t.line&&e.ch<t.ch}function j(e,t){return arguments.length>2&&(t=j.apply(void 0,Array.prototype.slice.call(arguments,1))),U(e,t)?e:t}function G(e,t){return arguments.length>2&&(t=G.apply(void 0,Array.prototype.slice.call(arguments,1))),U(e,t)?t:e}function q(e,t,n){var i=U(e,t),o=U(t,n);return i&&o}function Y(e,t){return e.getLine(t).length}function Q(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function J(e){return e.replace(/([.?*+$\[\]\/\\(){}|\-])/g,"\\$1")}function X(e,t,n){var i=Y(e,t),o=new Array(n-i+1).join(" ");e.setCursor(St(t,i)),e.replaceRange(o,e.getCursor())}function Z(e,t){var n=[],i=e.listSelections(),o=K(e.clipPos(t)),r=!V(t,o),s=e.getCursor("head"),a=te(i,s),c=V(i[a].head,i[a].anchor),l=i.length-1,h=l-a>a?l:0,u=i[h].anchor,d=Math.min(u.line,o.line),g=Math.max(u.line,o.line),p=u.ch,f=o.ch,m=i[h].head.ch-p,v=f-p;m>0&&0>=v?(p++,r||f--):0>m&&v>=0?(p--,c||f++):0>m&&-1==v&&(p--,f++);for(var C=d;g>=C;C++){var A={anchor:new St(C,p),head:new St(C,f)};n.push(A)}return a=o.line==g?n.length-1:0,e.setSelections(n),t.ch=f,u.ch=p,u}function ee(e,t,n){for(var i=[],o=0;n>o;o++){var r=I(t,o,0);i.push({anchor:r,head:r})}e.setSelections(i,0)}function te(e,t,n){for(var i=0;i<e.length;i++){var o="head"!=n&&V(e[i].anchor,t),r="anchor"!=n&&V(e[i].head,t);if(o||r)return i}return-1}function ne(e,t){var n=t.lastSelection,i=function(){var t=e.listSelections(),n=t[0],i=t[t.length-1],o=U(n.anchor,n.head)?n.anchor:n.head,r=U(i.anchor,i.head)?i.head:i.anchor;return[o,r]},o=function(){var t=e.getCursor(),i=e.getCursor(),o=n.visualBlock;if(o){var r=o.width,s=o.height;i=St(t.line+s,t.ch+r);for(var a=[],c=t.line;c<i.line;c++){var l=St(c,t.ch),h=St(c,i.ch),u={anchor:l,head:h};a.push(u)}e.setSelections(a)}else{var d=n.anchorMark.find(),g=n.headMark.find(),p=g.line-d.line,f=g.ch-d.ch;i={line:i.line+p,ch:p?i.ch:f+i.ch},n.visualLine&&(t=St(t.line,0),i=St(i.line,Y(e,i.line))),e.setSelection(t,i)}return[t,i]};return t.visualMode?i():o()}function ie(e,t){var n=t.sel.anchor,i=t.sel.head;t.lastPastedText&&(i=e.posFromIndex(e.indexFromPos(n)+t.lastPastedText.length),t.lastPastedText=null),t.lastSelection={anchorMark:e.setBookmark(n),headMark:e.setBookmark(i),anchor:K(n),head:K(i),visualMode:t.visualMode,visualLine:t.visualLine,visualBlock:t.visualBlock}}function oe(e,t,n){var i,o=e.state.vim.sel,r=o.head,s=o.anchor;return U(n,t)&&(i=n,n=t,t=i),U(r,s)?(r=j(t,r),s=G(s,n)):(s=j(t,s),r=G(r,n),r=I(r,0,-1),-1==r.ch&&r.line!=e.firstLine()&&(r=St(r.line-1,Y(e,r.line-1)))),[s,r]}function re(e,t,n){var i=e.state.vim;t=t||i.sel;var n=n||i.visualLine?"line":i.visualBlock?"block":"char",o=se(e,t,n);e.setSelections(o.ranges,o.primary),tt(e)}function se(e,t,n,i){var o=K(t.head),r=K(t.anchor);if("char"==n){var s=i||U(t.head,t.anchor)?0:1,a=U(t.head,t.anchor)?1:0;return o=I(t.head,0,s),r=I(t.anchor,0,a),{ranges:[{anchor:r,head:o}],primary:0}}if("line"==n){if(U(t.head,t.anchor))o.ch=0,r.ch=Y(e,r.line);else{r.ch=0;var c=e.lastLine();o.line>c&&(o.line=c),o.ch=Y(e,o.line)}return{ranges:[{anchor:r,head:o}],primary:0}}if("block"==n){for(var l=Math.min(r.line,o.line),h=Math.min(r.ch,o.ch),u=Math.max(r.line,o.line),d=Math.max(r.ch,o.ch)+1,g=u-l+1,p=o.line==l?0:g-1,f=[],m=0;g>m;m++)f.push({anchor:St(l+m,h),head:St(l+m,d)});return{ranges:f,primary:p}}}function ae(e){var t=e.getCursor("head");return 1==e.getSelection().length&&(t=j(t,e.getCursor("anchor"))),t}function ce(e,t){var n=e.state.vim;t!==!1&&e.setCursor(T(e,n.sel.head)),ie(e,n),n.visualMode=!1,n.visualLine=!1,n.visualBlock=!1,yt.signal(e,"vim-mode-change",{mode:"normal"}),n.fakeCursor&&n.fakeCursor.clear()}function le(e,t,n){var i=e.getRange(t,n);if(/\n\s*$/.test(i)){var o=i.split("\n");o.pop();for(var r,r=o.pop();o.length>0&&r&&v(r);r=o.pop())n.line--,n.ch=0;r?(n.line--,n.ch=Y(e,n.line)):n.ch=0}}function he(e,t,n){t.ch=0,n.ch=0,n.line++}function ue(e){if(!e)return 0;var t=e.search(/\S/);return-1==t?e.length:t}function de(e,t,n,i,o){for(var r=ae(e),s=e.getLine(r.line),a=r.ch,c=o?Dt[0]:Mt[0];!c(s.charAt(a));)if(a++,a>=s.length)return null;i?c=Mt[0]:(c=Dt[0],c(s.charAt(a))||(c=Dt[1]));for(var l=a,h=a;c(s.charAt(l))&&l<s.length;)l++;for(;c(s.charAt(h))&&h>=0;)h--;if(h++,t){for(var u=l;/\s/.test(s.charAt(l))&&l<s.length;)l++;if(u==l){for(var d=h;/\s/.test(s.charAt(h-1))&&h>0;)h--;h||(h=d)}}return{start:St(r.line,h),end:St(r.line,l)}}function ge(e,t,n){V(t,n)||Nt.jumpList.add(e,t,n)}function pe(e,t){Nt.lastChararacterSearch.increment=e,Nt.lastChararacterSearch.forward=t.forward,Nt.lastChararacterSearch.selectedCharacter=t.selectedCharacter}function fe(e,t,n,i){var o=K(e.getCursor()),r=n?1:-1,s=n?e.lineCount():-1,a=o.ch,c=o.line,l=e.getLine(c),h={lineText:l,nextCh:l.charAt(a),lastCh:null,index:a,symb:i,reverseSymb:(n?{")":"(","}":"{"}:{"(":")","{":"}"})[i],forward:n,depth:0,curMoveThrough:!1},u=qt[i];if(!u)return o;var d=Yt[u].init,g=Yt[u].isComplete;for(d&&d(h);c!==s&&t;){if(h.index+=r,h.nextCh=h.lineText.charAt(h.index),!h.nextCh){if(c+=r,h.lineText=e.getLine(c)||"",r>0)h.index=0;else{var p=h.lineText.length;h.index=p>0?p-1:0}h.nextCh=h.lineText.charAt(h.index)}g(h)&&(o.line=c,o.ch=h.index,t--)}return h.nextCh||h.curMoveThrough?St(c,h.index):o}function me(e,t,n,i,o){var r=t.line,s=t.ch,a=e.getLine(r),c=n?1:-1,l=i?Mt:Dt;if(o&&""==a){if(r+=c,a=e.getLine(r),!d(e,r))return null;s=n?0:a.length}for(;;){if(o&&""==a)return{from:0,to:0,line:r};for(var h=c>0?a.length:-1,u=h,g=h;s!=h;){for(var p=!1,f=0;f<l.length&&!p;++f)if(l[f](a.charAt(s))){for(u=s;s!=h&&l[f](a.charAt(s));)s+=c;if(g=s,p=u!=g,u==t.ch&&r==t.line&&g==u+c)continue;return{from:Math.min(u,g+1),to:Math.max(u,g),line:r}}p||(s+=c)}if(r+=c,!d(e,r))return null;a=e.getLine(r),s=c>0?0:a.length}throw new Error("The impossible happened.")}function ve(e,t,n,i,o,r){var s=K(t),a=[];(i&&!o||!i&&o)&&n++;for(var c=!(i&&o),l=0;n>l;l++){var h=me(e,t,i,r,c);if(!h){var u=Y(e,e.lastLine());a.push(i?{line:e.lastLine(),from:u,to:u}:{line:0,from:0,to:0});break}a.push(h),t=St(h.line,i?h.to-1:h.from)}var d=a.length!=n,g=a[0],p=a.pop();return i&&!o?(d||g.from==s.ch&&g.line==s.line||(p=a.pop()),St(p.line,p.from)):i&&o?St(p.line,p.to-1):!i&&o?(d||g.to==s.ch&&g.line==s.line||(p=a.pop()),St(p.line,p.to)):St(p.line,p.from)}function Ce(e,t,n,i){for(var o,r=e.getCursor(),s=r.ch,a=0;t>a;a++){var c=e.getLine(r.line);if(o=we(s,c,i,n,!0),-1==o)return null;s=o}return St(e.getCursor().line,o)}function Ae(e,t){var n=e.getCursor().line;return T(e,St(n,t-1))}function be(e,t,n,i){C(n,Ot)&&(t.marks[n]&&t.marks[n].clear(),t.marks[n]=e.setBookmark(i))}function we(e,t,n,i,o){var r;return i?(r=t.indexOf(n,e+1),-1==r||o||(r-=1)):(r=t.lastIndexOf(n,e-1),-1==r||o||(r+=1)),r}function ye(e,t,n,i,o){function r(t){return!/\S/.test(e.getLine(t))}function s(e,t,n){return n?r(e)!=r(e+t):!r(e)&&r(e+t)}function a(t){i=i>0?1:-1;var n=e.ace.session.getFoldLine(t);n&&t+i>n.start.row&&t+i<n.end.row&&(i=(i>0?n.end.row:n.start.row)-t)}var c,l,h=t.line,u=e.firstLine(),d=e.lastLine(),g=h;if(i){for(;g>=u&&d>=g&&n>0;)a(g),s(g,i)&&n--,g+=i;return new St(g,0)}var p=e.state.vim;if(p.visualLine&&s(h,1,!0)){var f=p.sel.anchor;s(f.line,-1,!0)&&(o&&f.line==h||(h+=1))}var m=r(h);for(g=h;d>=g&&n;g++)s(g,1,!0)&&(o&&r(g)==m||n--);for(l=new St(g,0),g>d&&!m?m=!0:o=!1,g=h;g>u&&(o&&r(g)!=m&&g!=h||!s(g,-1,!0));g--);return c=new St(g,0),{start:c,end:l}}function Ee(e,t,n,i){var o,r,s=t,a={"(":/[()]/,")":/[()]/,"[":/[[\]]/,"]":/[[\]]/,"{":/[{}]/,"}":/[{}]/}[n],c={"(":"(",")":"(","[":"[","]":"[","{":"{","}":"{"}[n],l=e.getLine(s.line).charAt(s.ch),h=l===c?1:0;if(o=e.scanForBracket(St(s.line,s.ch+h),-1,null,{bracketRegex:a}),r=e.scanForBracket(St(s.line,s.ch+h),1,null,{bracketRegex:a}),!o||!r)return{start:s,end:s};if(o=o.pos,r=r.pos,o.line==r.line&&o.ch>r.ch||o.line>r.line){var u=o;o=r,r=u}return i?r.ch+=1:o.ch+=1,{start:o,end:r}}function Fe(e,t,n,i){var o,r,s,a,c=K(t),l=e.getLine(c.line),h=l.split(""),u=h.indexOf(n);if(c.ch<u?c.ch=u:u<c.ch&&h[c.ch]==n&&(r=c.ch,--c.ch),h[c.ch]!=n||r)for(s=c.ch;s>-1&&!o;s--)h[s]==n&&(o=s+1);else o=c.ch+1;if(o&&!r)for(s=o,a=h.length;a>s&&!r;s++)h[s]==n&&(r=s);return o&&r?(i&&(--o,++r),{start:St(c.line,o),end:St(c.line,r)}):{start:c,end:c}}function xe(){}function Se(e){var t=e.state.vim;return t.searchState_||(t.searchState_=new xe)}function ke(e,t,n,i,o){e.openDialog?e.openDialog(t,i,{bottom:!0,value:o.value,onKeyDown:o.onKeyDown,onKeyUp:o.onKeyUp,selectValueOnOpen:!1}):i(prompt(n,""))}function $e(e){var t=Be(e)||[];if(!t.length)return[];var n=[];if(0===t[0]){for(var i=0;i<t.length;i++)"number"==typeof t[i]&&n.push(e.substring(t[i]+1,t[i+1]));return n}}function Be(e){for(var t=!1,n=[],i=0;i<e.length;i++){var o=e.charAt(i);t||"/"!=o||n.push(i),t=!t&&"\\"==o}return n}function Le(e){for(var t="|(){",n="}",i=!1,o=[],r=-1;r<e.length;r++){var s=e.charAt(r)||"",a=e.charAt(r+1)||"",c=a&&-1!=t.indexOf(a);i?("\\"===s&&c||o.push(s),i=!1):"\\"===s?(i=!0,a&&-1!=n.indexOf(a)&&(c=!0),c&&"\\"!==a||o.push(s)):(o.push(s),c&&"\\"!==a&&o.push("\\"))}return o.join("")}function De(e){for(var t=!1,n=[],i=-1;i<e.length;i++){var o=e.charAt(i)||"",r=e.charAt(i+1)||"";Qt[o+r]?(n.push(Qt[o+r]),i++):t?(n.push(o),t=!1):"\\"===o?(t=!0,f(r)||"$"===r?n.push("$"):"/"!==r&&"\\"!==r&&n.push("\\")):("$"===o&&n.push("$"),n.push(o),"/"===r&&n.push("\\"))}return n.join("")}function Me(e){for(var t=new yt.StringStream(e),n=[];!t.eol();){for(;t.peek()&&"\\"!=t.peek();)n.push(t.next());var i=!1;for(var o in Jt)if(t.match(o,!0)){i=!0,n.push(Jt[o]);break}i||n.push(t.next())}return n.join("")}function _e(e,t,n){var i=Nt.registerController.getRegister("/");if(i.setText(e),e instanceof RegExp)return e;var o,r,s=Be(e);if(s.length){o=e.substring(0,s[0]);var a=e.substring(s[0]);r=-1!=a.indexOf("i")}else o=e;if(!o)return null;w("pcre")||(o=Le(o)),n&&(t=/^[^A-Z]*$/.test(o));var c=new RegExp(o,t||r?"i":void 0);return c}function Re(e,t){e.openNotification?e.openNotification('<span style="color: red">'+t+"</span>",{bottom:!0,duration:5e3}):alert(t)}function Te(e,t){var n="";return e&&(n+='<span style="font-family: monospace">'+e+"</span>"),n+='<input type="text"/> <span style="color: #888">',t&&(n+='<span style="color: #888">',n+=t,n+="</span>"),n}function Oe(e,t){var n=(t.prefix||"")+" "+(t.desc||""),i=Te(t.prefix,t.desc);ke(e,i,n,t.onClose,t)}function Ie(e,t){if(e instanceof RegExp&&t instanceof RegExp){for(var n=["global","multiline","ignoreCase","source"],i=0;i<n.length;i++){var o=n[i];if(e[o]!==t[o])return!1}return!0}return!1}function Pe(e,t,n,i){if(t){var o=Se(e),r=_e(t,!!n,!!i);if(r)return He(e,r),Ie(r,o.getQuery())?r:(o.setQuery(r),r)}}function We(e){if("^"==e.source.charAt(0))var t=!0;return{token:function(n){if(t&&!n.sol())return void n.skipToEnd();var i=n.match(e,!1);if(i)return 0==i[0].length?(n.next(),"searching"):n.sol()||(n.backUp(1),e.exec(n.next()+i[0]))?(n.match(e),"searching"):(n.next(),null);for(;!n.eol()&&(n.next(),!n.match(e,!1)););},query:e}}function He(e,t){var n=Se(e),i=n.getOverlay();i&&t==i.query||(i&&e.removeOverlay(i),i=We(t),e.addOverlay(i),e.showMatchesOnScrollbar&&(n.getScrollbarAnnotate()&&n.getScrollbarAnnotate().clear(),n.setScrollbarAnnotate(e.showMatchesOnScrollbar(t))),n.setOverlay(i))}function Ne(e,t,n,i){return void 0===i&&(i=1),e.operation(function(){for(var o=e.getCursor(),r=e.getSearchCursor(n,o),s=0;i>s;s++){var a=r.find(t);if(0==s&&a&&V(r.from(),o)&&(a=r.find(t)),!a&&(r=e.getSearchCursor(n,t?St(e.lastLine()):St(e.firstLine(),0)),!r.find(t)))return}return r.from()})}function ze(e){var t=Se(e);e.removeOverlay(Se(e).getOverlay()),t.setOverlay(null),t.getScrollbarAnnotate()&&(t.getScrollbarAnnotate().clear(),t.setScrollbarAnnotate(null))}function Ke(e,t,n){return"number"!=typeof e&&(e=e.line),t instanceof Array?C(e,t):n?e>=t&&n>=e:e==t}function Ve(e){var t=e.ace.renderer;return{top:t.getFirstFullyVisibleRow(),bottom:t.getLastFullyVisibleRow()}}function Ue(e,t,n,i,o,r,s,a,c){function l(){e.operation(function(){for(;!p;)h(),u();d()})}function h(){var t=e.getRange(r.from(),r.to()),n=t.replace(s,a);r.replace(n)}function u(){for(;r.findNext()&&Ke(r.from(),i,o);)if(n||!f||r.from().line!=f.line)return e.scrollIntoView(r.from(),30),e.setSelection(r.from(),r.to()),f=r.from(),void(p=!1);p=!0}function d(t){if(t&&t(),e.focus(),f){e.setCursor(f);var n=e.state.vim;n.exMode=!1,n.lastHPos=n.lastHSPos=f.ch}c&&c()}function g(t,n,i){yt.e_stop(t);var o=yt.keyName(t);switch(o){case"Y":h(),u();break;case"N":u();break;case"A":var r=c;c=void 0,e.operation(l),c=r;break;case"L":h();case"Q":case"Esc":case"Ctrl-C":case"Ctrl-[":d(i)}return p&&d(i),!0}e.state.vim.exMode=!0;var p=!1,f=r.from();return u(),p?void Re(e,"No matches for "+s.source):t?void Oe(e,{prefix:"replace with <strong>"+a+"</strong> (y/n/a/q/l)",onKeyDown:g}):(l(),void(c&&c()))}function je(e){var t=e.state.vim,n=Nt.macroModeState,i=Nt.registerController.getRegister("."),o=n.isPlaying,r=n.lastInsertModeChanges,s=[];if(!o){for(var a=r.inVisualBlock?t.lastSelection.visualBlock.height:1,c=r.changes,s=[],l=0;l<c.length;)s.push(c[l]),c[l]instanceof it?l++:l+=a;r.changes=s,e.off("change",Ze),yt.off(e.getInputField(),"keydown",ot)}!o&&t.insertModeRepeat>1&&(rt(e,t,t.insertModeRepeat-1,!0),t.lastEditInputState.repeatOverride=t.insertModeRepeat),delete t.insertModeRepeat,t.insertMode=!1,e.setCursor(e.getCursor().line,e.getCursor().ch-1),e.setOption("keyMap","vim"),e.setOption("disableInput",!0),e.toggleOverwrite(!1),i.setText(r.changes.join("")),yt.signal(e,"vim-mode-change",{mode:"normal"}),n.isRecording&&Je(n)}function Ge(e){Ft.unshift(e)}function qe(e,t,n,i,o){var r={keys:e,type:t};r[t]=n,r[t+"Args"]=i;for(var s in o)r[s]=o[s];Ge(r)}function Ye(e,t,n,i){var o=Nt.registerController.getRegister(i);if(":"==i)return o.keyBuffer[0]&&tn.processCommand(e,o.keyBuffer[0]),void(n.isPlaying=!1);var r=o.keyBuffer,s=0;n.isPlaying=!0,n.replaySearchQueries=o.searchQueries.slice(0);for(var a=0;a<r.length;a++)for(var c,l,h=r[a];h;)if(c=/<\w+-.+?>|<\w+>|./.exec(h),l=c[0],h=h.substring(c.index+l.length),yt.Vim.handleKey(e,l,"macro"),t.insertMode){var u=o.insertModeChanges[s++].changes;Nt.macroModeState.lastInsertModeChanges.changes=u,st(e,u,1),je(e)}n.isPlaying=!1}function Qe(e,t){if(!e.isPlaying){var n=e.latestRegister,i=Nt.registerController.getRegister(n);i&&i.pushText(t)}}function Je(e){if(!e.isPlaying){var t=e.latestRegister,n=Nt.registerController.getRegister(t);n&&n.pushInsertModeChanges&&n.pushInsertModeChanges(e.lastInsertModeChanges)}}function Xe(e,t){if(!e.isPlaying){var n=e.latestRegister,i=Nt.registerController.getRegister(n);i&&i.pushSearchQuery&&i.pushSearchQuery(t)}}function Ze(e,t){var n=Nt.macroModeState,i=n.lastInsertModeChanges;if(!n.isPlaying)for(;t;){if(i.expectCursorActivityForChange=!0,"+input"==t.origin||"paste"==t.origin||void 0===t.origin){var o=t.text.join("\n");i.changes.push(o)}t=t.next}}function et(e){var t=e.state.vim;if(t.insertMode){var n=Nt.macroModeState;if(n.isPlaying)return;var i=n.lastInsertModeChanges;i.expectCursorActivityForChange?i.expectCursorActivityForChange=!1:i.changes=[]}else e.curOp.isVimOp||nt(e,t);t.visualMode&&tt(e)}function tt(e){var t=e.state.vim,n=T(e,K(t.sel.head)),i=I(n,0,1);t.fakeCursor&&t.fakeCursor.clear(),t.fakeCursor=e.markText(n,i,{className:"cm-animate-fat-cursor"})}function nt(e,t){var n=e.getCursor("anchor"),i=e.getCursor("head");if(t.visualMode&&!e.somethingSelected()?ce(e,!1):t.visualMode||t.insertMode||!e.somethingSelected()||(t.visualMode=!0,t.visualLine=!1,yt.signal(e,"vim-mode-change",{mode:"visual"})),t.visualMode){var o=U(i,n)?0:-1,r=U(i,n)?-1:0;i=I(i,0,o),n=I(n,0,r),t.sel={anchor:n,head:i},be(e,t,"<",j(i,n)),be(e,t,">",G(i,n))}else t.insertMode||(t.lastHPos=e.getCursor().ch)}function it(e){this.keyName=e}function ot(e){function t(){return i.changes.push(new it(o)),!0}var n=Nt.macroModeState,i=n.lastInsertModeChanges,o=yt.keyName(e);o&&(-1==o.indexOf("Delete")&&-1==o.indexOf("Backspace")||yt.lookupKey(o,"vim-insert",t))}function rt(e,t,n,i){function o(){a?Vt.processAction(e,t,t.lastEditActionCommand):Vt.evalInput(e,t)}function r(n){if(s.lastInsertModeChanges.changes.length>0){n=t.lastEditActionCommand?n:1;var i=s.lastInsertModeChanges;st(e,i.changes,n)}}var s=Nt.macroModeState;s.isPlaying=!0;var a=!!t.lastEditActionCommand,c=t.inputState;if(t.inputState=t.lastEditInputState,a&&t.lastEditActionCommand.interlaceInsertRepeat)for(var l=0;n>l;l++)o(),r(1);else i||o(),r(n);t.inputState=c,t.insertMode&&!i&&je(e),s.isPlaying=!1}function st(e,t,n){function i(t){return"string"==typeof t?yt.commands[t](e):t(e),!0}var o=e.getCursor("head"),r=Nt.macroModeState.lastInsertModeChanges.inVisualBlock;if(r){var s=e.state.vim,a=s.lastSelection,c=P(a.anchor,a.head);ee(e,o,c.line+1),n=e.listSelections().length,e.setCursor(o)}for(var l=0;n>l;l++){r&&e.setCursor(I(o,l,0));for(var h=0;h<t.length;h++){var u=t[h];if(u instanceof it)yt.lookupKey(u.keyName,"vim-insert",i);else{var d=e.getCursor();e.replaceRange(u,d,d)}}}r&&e.setCursor(I(o,0,1))}function at(e,t,n){t.length>1&&"n"==t[0]&&(t=t.replace("numpad","")),t=nn[t]||t;var i="";return n.ctrlKey&&(i+="C-"),n.altKey&&(i+="A-"),n.shiftKey&&(i+="S-"),i+=t,i.length>1&&(i="<"+i+">"),i}function ct(e){var t=new e.constructor;return Object.keys(e).forEach(function(n){var i=e[n];Array.isArray(i)?i=i.slice():i&&"object"==typeof i&&i.constructor!=Object&&(i=ct(i)),t[n]=i}),e.sel&&(t.sel={head:e.sel.head&&K(e.sel.head),anchor:e.sel.anchor&&K(e.sel.anchor)}),t}function lt(e,t,n){var i=!1,o=kt.maybeInitVimState_(e),r=o.visualBlock||o.wasInVisualBlock;if(o.wasInVisualBlock&&!e.ace.inMultiSelectMode?o.wasInVisualBlock=!1:e.ace.inMultiSelectMode&&o.visualBlock&&(o.wasInVisualBlock=!0),"<Esc>"!=t||o.insertMode||o.visualMode||!e.ace.inMultiSelectMode)if(r||!e.ace.inMultiSelectMode||e.ace.inVirtualSelectionMode)i=kt.handleKey(e,t,n);else{var s=ct(o);e.operation(function(){e.ace.forEachSelection(function(){var o=e.ace.selection;e.state.vim.lastHPos=null==o.$desiredColumn?o.lead.column:o.$desiredColumn;var r=e.getCursor("head"),a=e.getCursor("anchor"),c=U(r,a)?0:-1,l=U(r,a)?-1:0;r=I(r,0,c),a=I(a,0,l),e.state.vim.sel.head=r,e.state.vim.sel.anchor=a,i=on(e,t,n),o.$desiredColumn=-1==e.state.vim.lastHPos?null:e.state.vim.lastHPos,e.virtualSelectionMode()&&(e.state.vim=ct(s))}),e.curOp.cursorActivity&&!i&&(e.curOp.cursorActivity=!1)},!0)}else e.ace.exitMultiSelectMode();return i}function ht(e,t){t.off("beforeEndOperation",ht);var n=t.state.cm.vimCmd;n&&t.execCommand(n.exec?n:n.name,n.args),t.curOp=t.prevOp}var ut=e("../range").Range,dt=e("../lib/event_emitter").EventEmitter,gt=e("../lib/dom"),pt=e("../lib/oop"),ft=e("../lib/keys"),mt=e("../lib/event"),vt=e("../search").Search,Ct=e("../lib/useragent"),At=e("../search_highlight").SearchHighlight,bt=e("../commands/multi_select_commands"),wt=e("../mode/text").Mode.prototype.tokenRe;e("../multi_select");var yt=function(e){this.ace=e,this.state={},this.marks={},this.$uid=0,this.onChange=this.onChange.bind(this),this.onSelectionChange=this.onSelectionChange.bind(this),this.onBeforeEndOperation=this.onBeforeEndOperation.bind(this),this.ace.on("change",this.onChange),this.ace.on("changeSelection",this.onSelectionChange),this.ace.on("beforeEndOperation",this.onBeforeEndOperation)};yt.Pos=function(e,t){return this instanceof St?(this.line=e,void(this.ch=t)):new St(e,t)},yt.defineOption=function(){},yt.commands={redo:function(e){e.ace.redo()},undo:function(e){e.ace.undo()},newlineAndIndent:function(e){e.ace.insert("\n")}},yt.keyMap={},yt.addClass=yt.rmClass=yt.e_stop=function(){},yt.keyName=function(e){if(e.key)return e.key;var t=ft[e.keyCode]||"";return 1==t.length&&(t=t.toUpperCase()),t=mt.getModifierString(e).replace(/(^|-)\w/g,function(e){return e.toUpperCase()})+t},yt.keyMap["default"]=function(e){return function(t){var n=t.ace.commands.commandKeyBinding[e.toLowerCase()];return n&&t.ace.execCommand(n)!==!1}},yt.lookupKey=function sn(e,t,n){"string"==typeof t&&(t=yt.keyMap[t]);var i="function"==typeof t?t(e):t[e];if(i===!1)return"nothing";if("..."===i)return"multi";if(null!=i&&n(i))return"handled";if(t.fallthrough){if(!Array.isArray(t.fallthrough))return sn(e,t.fallthrough,n);for(var o=0;o<t.fallthrough.length;o++){var r=sn(e,t.fallthrough[o],n);if(r)return r}}},yt.signal=function(e,t,n){return e._signal(t,n)},yt.on=mt.addListener,yt.off=mt.removeListener,yt.isWordChar=function(e){return"">e?/^\w$/.test(e):(wt.lastIndex=0,wt.test(e))},function(){pt.implement(yt.prototype,dt),this.destroy=function(){this.ace.off("change",this.onChange),this.ace.off("changeSelection",this.onSelectionChange),this.ace.off("beforeEndOperation",this.onBeforeEndOperation),this.removeOverlay()},this.virtualSelectionMode=function(){return this.ace.inVirtualSelectionMode&&this.ace.selection.index},this.onChange=function(e){if("i"==e.action[0]){var t={text:e.lines},n=this.curOp=this.curOp||{};if(n.changeHandlers||(n.changeHandlers=this._eventRegistry.change&&this._eventRegistry.change.slice()),this.virtualSelectionMode())return;n.lastChange?n.lastChange.next=n.lastChange=t:n.lastChange=n.change=t}this.$updateMarkers(e)},this.onSelectionChange=function(){var e=this.curOp=this.curOp||{};e.cursorActivityHandlers||(e.cursorActivityHandlers=this._eventRegistry.cursorActivity&&this._eventRegistry.cursorActivity.slice()),this.curOp.cursorActivity=!0,this.ace.inMultiSelectMode&&this.ace.keyBinding.removeKeyboardHandler(bt.keyboardHandler)},this.operation=function(e,t){if(!t&&this.curOp||t&&this.curOp&&this.curOp.force)return e();if(!t&&this.ace.curOp||this.curOp&&this.onBeforeEndOperation(),!this.ace.curOp){var n=this.ace.prevOp;this.ace.startOperation({command:{name:"vim",scrollIntoView:"cursor"}})}var i=this.curOp=this.curOp||{};this.curOp.force=t;var o=e();return this.ace.curOp&&"vim"==this.ace.curOp.command.name&&(this.ace.endOperation(),i.cursorActivity||i.lastChange||!n||(this.ace.prevOp=n)),!t&&this.ace.curOp||this.curOp&&this.onBeforeEndOperation(),o},this.onBeforeEndOperation=function(){var e=this.curOp;e&&(e.change&&this.signal("change",e.change,e),e&&e.cursorActivity&&this.signal("cursorActivity",null,e),this.curOp=null)},this.signal=function(e,t,n){var i=n?n[e+"Handlers"]:(this._eventRegistry||{})[e];if(i){i=i.slice();for(var o=0;o<i.length;o++)i[o](this,t)}},this.firstLine=function(){return 0},this.lastLine=function(){return this.ace.session.getLength()-1},this.lineCount=function(){return this.ace.session.getLength()},this.setCursor=function(e,t){"object"==typeof e&&(t=e.ch,e=e.line),this.ace.inVirtualSelectionMode||this.ace.exitMultiSelectMode(),this.ace.session.unfold({row:e,column:t}),this.ace.selection.moveTo(e,t)},this.getCursor=function(e){var t=this.ace.selection,n="anchor"==e?t.isEmpty()?t.lead:t.anchor:"head"!=e&&e?t.getRange()[e]:t.lead;return i(n)},this.listSelections=function(){var e=this.ace.multiSelect.rangeList.ranges;return!e.length||this.ace.inVirtualSelectionMode?[{anchor:this.getCursor("anchor"),head:this.getCursor("head")}]:e.map(function(e){return{anchor:this.clipPos(i(e.cursor==e.end?e.start:e.end)),head:this.clipPos(i(e.cursor))}},this)},this.setSelections=function(e,t){var i=this.ace.multiSelect,o=e.map(function(e){var t=n(e.anchor),i=n(e.head),o=ut.comparePoints(t,i)<0?new ut.fromPoints(t,i):new ut.fromPoints(i,t);return o.cursor=ut.comparePoints(o.start,i)?o.end:o.start,o});if(this.ace.inVirtualSelectionMode)return void this.ace.selection.fromOrientedRange(o[0]);t?o[t]&&o.push(o.splice(t,1)[0]):o=o.reverse(),i.toSingleRange(o[0].clone());for(var r=this.ace.session,s=0;s<o.length;s++){var a=r.$clipRangeToDocument(o[s]);i.addRange(a)}},this.setSelection=function(e,t,n){var i=this.ace.selection;i.moveTo(e.line,e.ch),i.selectTo(t.line,t.ch),n&&"*mouse"==n.origin&&this.onBeforeEndOperation()},this.somethingSelected=function(){return!this.ace.selection.isEmpty()},this.clipPos=function(e){var t=this.ace.session.$clipPositionToDocument(e.line,e.ch);return i(t)},this.markText=function(){return{clear:function(){},find:function(){}}},this.$updateMarkers=function(e){var t="insert"==e.action,n=e.start,i=e.end,o=(i.row-n.row)*(t?1:-1),r=(i.column-n.column)*(t?1:-1);t&&(i=n);for(var s in this.marks){var a=this.marks[s],c=ut.comparePoints(a,n);if(!(0>c)){if(0===c&&t){if(1!=a.bias){-1==a.bias;continue}c=1}var l=t?c:ut.comparePoints(a,i);l>0?(a.row+=o,a.column+=a.row==i.row?r:0):!t&&0>=l&&(a.row=n.row,a.column=n.column,0===l&&(a.bias=1))}}};var e=function(e,t,n,i){this.cm=e,this.id=t,this.row=n,this.column=i,e.marks[this.id]=this};e.prototype.clear=function(){delete this.cm.marks[this.id]},e.prototype.find=function(){return i(this)},this.setBookmark=function(t,n){var i=new e(this,this.$uid++,t.line,t.ch);return n&&n.insertLeft||(i.$insertRight=!0),this.marks[i.id]=i,i},this.moveH=function(e,t){if("char"==t){var n=this.ace.selection;n.clearSelection(),n.moveCursorBy(0,e)}},this.findPosV=function(e,t,n,o){if("page"==n){var r=this.ace.renderer,s=r.layerConfig;t*=Math.floor(s.height/s.lineHeight),n="line"}if("line"==n){var a=this.ace.session.documentToScreenPosition(e.line,e.ch);null!=o&&(a.column=o),a.row+=t,a.row=Math.min(Math.max(0,a.row),this.ace.session.getScreenLength()-1);var c=this.ace.session.screenToDocumentPosition(a.row,a.column);return i(c)}},this.charCoords=function(e,t){if("div"==t||!t){var n=this.ace.session.documentToScreenPosition(e.line,e.ch);return{left:n.column,top:n.row}}if("local"==t){var i=this.ace.renderer,n=this.ace.session.documentToScreenPosition(e.line,e.ch),o=i.layerConfig.lineHeight,r=i.layerConfig.characterWidth,s=o*n.row;return{left:n.column*r,top:s,bottom:s+o}}},this.coordsChar=function(e,t){var n=this.ace.renderer;if("local"==t){var o=Math.max(0,Math.floor(e.top/n.lineHeight)),r=Math.max(0,Math.floor(e.left/n.characterWidth)),s=n.session.screenToDocumentPosition(o,r);return i(s)}if("div"==t)throw"not implemented"},this.getSearchCursor=function(e,t){var n=!1,o=!1;e instanceof RegExp&&!e.global&&(n=!e.ignoreCase,e=e.source,o=!0);var r=new vt;void 0==t.ch&&(t.ch=Number.MAX_VALUE);var s={row:t.line,column:t.ch},a=this,c=null;return{findNext:function(){return this.find(!1)},findPrevious:function(){return this.find(!0)},find:function(t){r.setOptions({needle:e,caseSensitive:n,wrap:!1,backwards:t,regExp:o,start:c||s});var i=r.find(a.ace.session);return i&&i.isEmpty()&&a.getLine(i.start.row).length==i.start.column&&(r.$options.start=i,i=r.find(a.ace.session)),c=i},from:function(){return c&&i(c.start)},to:function(){return c&&i(c.end)},replace:function(e){c&&(c.end=a.ace.session.doc.replace(c,e))}}},this.scrollTo=function(e,t){var n=this.ace.renderer,i=n.layerConfig,o=i.maxHeight;o-=(n.$size.scrollerHeight-n.lineHeight)*n.$scrollPastEnd,null!=t&&this.ace.session.setScrollTop(Math.max(0,Math.min(t,o))),null!=e&&this.ace.session.setScrollLeft(Math.max(0,Math.min(e,i.width)))},this.scrollInfo=function(){return 0},this.scrollIntoView=function(e,t){if(e){var i=this.ace.renderer,o={top:0,bottom:t};i.scrollCursorIntoView(n(e),2*i.lineHeight/i.$size.scrollerHeight,o)}},this.getLine=function(e){return this.ace.session.getLine(e)},this.getRange=function(e,t){return this.ace.session.getTextRange(new ut(e.line,e.ch,t.line,t.ch))},this.replaceRange=function(e,t,n){return n||(n=t),this.ace.session.replace(new ut(t.line,t.ch,n.line,n.ch),e);
},this.replaceSelections=function(e){var t=this.ace.selection;if(this.ace.inVirtualSelectionMode)return void this.ace.session.replace(t.getRange(),e[0]||"");t.inVirtualSelectionMode=!0;var n=t.rangeList.ranges;n.length||(n=[this.ace.multiSelect.getRange()]);for(var i=n.length;i--;)this.ace.session.replace(n[i],e[i]||"");t.inVirtualSelectionMode=!1},this.getSelection=function(){return this.ace.getSelectedText()},this.getSelections=function(){return this.listSelections().map(function(e){return this.getRange(e.anchor,e.head)},this)},this.getInputField=function(){return this.ace.textInput.getElement()},this.getWrapperElement=function(){return this.ace.containter};var t={indentWithTabs:"useSoftTabs",indentUnit:"tabSize",tabSize:"tabSize",firstLineNumber:"firstLineNumber",readOnly:"readOnly"};this.setOption=function(e,n){switch(this.state[e]=n,e){case"indentWithTabs":e=t[e],n=!n;break;default:e=t[e]}e&&this.ace.setOption(e,n)},this.getOption=function(e,n){var i=t[e];switch(i&&(n=this.ace.getOption(i)),e){case"indentWithTabs":return e=t[e],!n}return i?n:this.state[e]},this.toggleOverwrite=function(e){return this.state.overwrite=e,this.ace.setOverwrite(e)},this.addOverlay=function(e){if(!this.$searchHighlight||!this.$searchHighlight.session){var t=new At(null,"ace_highlight-marker","text"),n=this.ace.session.addDynamicMarker(t);t.id=n.id,t.session=this.ace.session,t.destroy=function(){t.session.off("change",t.updateOnChange),t.session.off("changeEditor",t.destroy),t.session.removeMarker(t.id),t.session=null},t.updateOnChange=function(e){var n=e.start.row;n==e.end.row?t.cache[n]=void 0:t.cache.splice(n,t.cache.length)},t.session.on("changeEditor",t.destroy),t.session.on("change",t.updateOnChange)}var i=new RegExp(e.query.source,"gmi");this.$searchHighlight=e.highlight=t,this.$searchHighlight.setRegexp(i),this.ace.renderer.updateBackMarkers()},this.removeOverlay=function(){this.$searchHighlight&&this.$searchHighlight.session&&this.$searchHighlight.destroy()},this.getScrollInfo=function(){var e=this.ace.renderer,t=e.layerConfig;return{left:e.scrollLeft,top:e.scrollTop,height:t.maxHeight,width:t.width,clientHeight:t.height,clientWidth:t.width}},this.getValue=function(){return this.ace.getValue()},this.setValue=function(e){return this.ace.setValue(e)},this.getTokenTypeAt=function(e){var t=this.ace.session.getTokenAt(e.line,e.ch);return t&&/comment|string/.test(t.type)?"string":""},this.findMatchingBracket=function(e){var t=this.ace.session.findMatchingBracket(n(e));return{to:t&&i(t)}},this.indentLine=function(e,t){t===!0?this.ace.session.indentRows(e,e,"	"):t===!1&&this.ace.session.outdentRows(new ut(e,0,e,0))},this.indexFromPos=function(e){return this.ace.session.doc.positionToIndex(n(e))},this.posFromIndex=function(e){return i(this.ace.session.doc.indexToPosition(e))},this.focus=function(){return this.ace.focus()},this.blur=function(){return this.ace.blur()},this.defaultTextHeight=function(){return this.ace.renderer.layerConfig.lineHeight},this.scanForBracket=function(e,t,o,r){var s=r.bracketRegex.source;if(1==t)var a=this.ace.session.$findClosingBracket(s.slice(1,2),n(e),/paren|text/);else var a=this.ace.session.$findOpeningBracket(s.slice(-2,-1),{row:e.line,column:e.ch+1},/paren|text/);return a&&{pos:i(a)}},this.refresh=function(){return this.ace.resize(!0)},this.getMode=function(){return{name:this.getOption("mode")}}}.call(yt.prototype);var Et=yt.StringStream=function(e,t){this.pos=this.start=0,this.string=e,this.tabSize=t||8,this.lastColumnPos=this.lastColumnValue=0,this.lineStart=0};Et.prototype={eol:function(){return this.pos>=this.string.length},sol:function(){return this.pos==this.lineStart},peek:function(){return this.string.charAt(this.pos)||void 0},next:function(){return this.pos<this.string.length?this.string.charAt(this.pos++):void 0},eat:function(e){var t=this.string.charAt(this.pos);if("string"==typeof e)var n=t==e;else var n=t&&(e.test?e.test(t):e(t));return n?(++this.pos,t):void 0},eatWhile:function(e){for(var t=this.pos;this.eat(e););return this.pos>t},eatSpace:function(){for(var e=this.pos;/[\s\u00a0]/.test(this.string.charAt(this.pos));)++this.pos;return this.pos>e},skipToEnd:function(){this.pos=this.string.length},skipTo:function(e){var t=this.string.indexOf(e,this.pos);return t>-1?(this.pos=t,!0):void 0},backUp:function(e){this.pos-=e},column:function(){throw"not implemented"},indentation:function(){throw"not implemented"},match:function(e,t,n){if("string"!=typeof e){var i=this.string.slice(this.pos).match(e);return i&&i.index>0?null:(i&&t!==!1&&(this.pos+=i[0].length),i)}var o=function(e){return n?e.toLowerCase():e},r=this.string.substr(this.pos,e.length);return o(r)==o(e)?(t!==!1&&(this.pos+=e.length),!0):void 0},current:function(){return this.string.slice(this.start,this.pos)},hideFirstChars:function(e,t){this.lineStart+=e;try{return t()}finally{this.lineStart-=e}}},yt.defineExtension=function(e,t){yt.prototype[e]=t},gt.importCssString(".normal-mode .ace_cursor{  border: 1px solid red;  background-color: red;  opacity: 0.5;}.normal-mode .ace_hidden-cursors .ace_cursor{  background-color: transparent;}.ace_dialog {  position: absolute;  left: 0; right: 0;  background: white;  z-index: 15;  padding: .1em .8em;  overflow: hidden;  color: #333;}.ace_dialog-top {  border-bottom: 1px solid #eee;  top: 0;}.ace_dialog-bottom {  border-top: 1px solid #eee;  bottom: 0;}.ace_dialog input {  border: none;  outline: none;  background: transparent;  width: 20em;  color: inherit;  font-family: monospace;}","vimMode"),function(){function e(e,t,n){var i,o=e.ace.container;return i=o.appendChild(document.createElement("div")),n?i.className="ace_dialog ace_dialog-bottom":i.className="ace_dialog ace_dialog-top","string"==typeof t?i.innerHTML=t:i.appendChild(t),i}function t(e,t){e.state.currentNotificationClose&&e.state.currentNotificationClose(),e.state.currentNotificationClose=t}yt.defineExtension("openDialog",function(n,i,o){function r(e){if("string"==typeof e)h.value=e;else{if(c)return;c=!0,a.parentNode.removeChild(a),l.focus(),o.onClose&&o.onClose(a)}}if(!this.virtualSelectionMode()){o||(o={}),t(this,null);var s,a=e(this,n,o.bottom),c=!1,l=this,h=a.getElementsByTagName("input")[0];return h?(o.value&&(h.value=o.value,o.select!==!1&&h.select()),o.onInput&&yt.on(h,"input",function(e){o.onInput(e,h.value,r)}),o.onKeyUp&&yt.on(h,"keyup",function(e){o.onKeyUp(e,h.value,r)}),yt.on(h,"keydown",function(e){o&&o.onKeyDown&&o.onKeyDown(e,h.value,r)||((27==e.keyCode||o.closeOnEnter!==!1&&13==e.keyCode)&&(h.blur(),yt.e_stop(e),r()),13==e.keyCode&&i(h.value))}),o.closeOnBlur!==!1&&yt.on(h,"blur",r),h.focus()):(s=a.getElementsByTagName("button")[0])&&(yt.on(s,"click",function(){r(),l.focus()}),o.closeOnBlur!==!1&&yt.on(s,"blur",r),s.focus()),r}}),yt.defineExtension("openNotification",function(n,i){function o(){a||(a=!0,clearTimeout(r),s.parentNode.removeChild(s))}if(!this.virtualSelectionMode()){t(this,o);var r,s=e(this,n,i&&i.bottom),a=!1,c=i&&"undefined"!=typeof i.duration?i.duration:5e3;return yt.on(s,"click",function(e){yt.e_preventDefault(e),o()}),c&&(r=setTimeout(o,c)),o}})}();var Ft=[{keys:"<Left>",type:"keyToKey",toKeys:"h"},{keys:"<Right>",type:"keyToKey",toKeys:"l"},{keys:"<Up>",type:"keyToKey",toKeys:"k"},{keys:"<Down>",type:"keyToKey",toKeys:"j"},{keys:"<Space>",type:"keyToKey",toKeys:"l"},{keys:"<BS>",type:"keyToKey",toKeys:"h",context:"normal"},{keys:"<C-Space>",type:"keyToKey",toKeys:"W"},{keys:"<C-BS>",type:"keyToKey",toKeys:"B",context:"normal"},{keys:"<S-Space>",type:"keyToKey",toKeys:"w"},{keys:"<S-BS>",type:"keyToKey",toKeys:"b",context:"normal"},{keys:"<C-n>",type:"keyToKey",toKeys:"j"},{keys:"<C-p>",type:"keyToKey",toKeys:"k"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>"},{keys:"<C-[>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"<C-c>",type:"keyToKey",toKeys:"<Esc>",context:"insert"},{keys:"s",type:"keyToKey",toKeys:"cl",context:"normal"},{keys:"s",type:"keyToKey",toKeys:"xi",context:"visual"},{keys:"S",type:"keyToKey",toKeys:"cc",context:"normal"},{keys:"S",type:"keyToKey",toKeys:"dcc",context:"visual"},{keys:"<Home>",type:"keyToKey",toKeys:"0"},{keys:"<End>",type:"keyToKey",toKeys:"$"},{keys:"<PageUp>",type:"keyToKey",toKeys:"<C-b>"},{keys:"<PageDown>",type:"keyToKey",toKeys:"<C-f>"},{keys:"<CR>",type:"keyToKey",toKeys:"j^",context:"normal"},{keys:"H",type:"motion",motion:"moveToTopLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"M",type:"motion",motion:"moveToMiddleLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"L",type:"motion",motion:"moveToBottomLine",motionArgs:{linewise:!0,toJumplist:!0}},{keys:"h",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!1}},{keys:"l",type:"motion",motion:"moveByCharacters",motionArgs:{forward:!0}},{keys:"j",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,linewise:!0}},{keys:"k",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,linewise:!0}},{keys:"gj",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!0}},{keys:"gk",type:"motion",motion:"moveByDisplayLines",motionArgs:{forward:!1}},{keys:"w",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1}},{keys:"W",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!1,bigWord:!0}},{keys:"e",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,inclusive:!0}},{keys:"E",type:"motion",motion:"moveByWords",motionArgs:{forward:!0,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"b",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1}},{keys:"B",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1,bigWord:!0}},{keys:"ge",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,inclusive:!0}},{keys:"gE",type:"motion",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!0,bigWord:!0,inclusive:!0}},{keys:"{",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!1,toJumplist:!0}},{keys:"}",type:"motion",motion:"moveByParagraph",motionArgs:{forward:!0,toJumplist:!0}},{keys:"<C-f>",type:"motion",motion:"moveByPage",motionArgs:{forward:!0}},{keys:"<C-b>",type:"motion",motion:"moveByPage",motionArgs:{forward:!1}},{keys:"<C-d>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!0,explicitRepeat:!0}},{keys:"<C-u>",type:"motion",motion:"moveByScroll",motionArgs:{forward:!1,explicitRepeat:!0}},{keys:"gg",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"G",type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!0,explicitRepeat:!0,linewise:!0,toJumplist:!0}},{keys:"0",type:"motion",motion:"moveToStartOfLine"},{keys:"^",type:"motion",motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"+",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0}},{keys:"-",type:"motion",motion:"moveByLines",motionArgs:{forward:!1,toFirstChar:!0}},{keys:"_",type:"motion",motion:"moveByLines",motionArgs:{forward:!0,toFirstChar:!0,repeatOffset:-1}},{keys:"$",type:"motion",motion:"moveToEol",motionArgs:{inclusive:!0}},{keys:"%",type:"motion",motion:"moveToMatchedSymbol",motionArgs:{inclusive:!0,toJumplist:!0}},{keys:"f<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"F<character>",type:"motion",motion:"moveToCharacter",motionArgs:{forward:!1}},{keys:"t<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!0,inclusive:!0}},{keys:"T<character>",type:"motion",motion:"moveTillCharacter",motionArgs:{forward:!1}},{keys:";",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!0}},{keys:",",type:"motion",motion:"repeatLastCharacterSearch",motionArgs:{forward:!1}},{keys:"'<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0,linewise:!0}},{keys:"`<character>",type:"motion",motion:"goToMark",motionArgs:{toJumplist:!0}},{keys:"]`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0}},{keys:"[`",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1}},{keys:"]'",type:"motion",motion:"jumpToMark",motionArgs:{forward:!0,linewise:!0}},{keys:"['",type:"motion",motion:"jumpToMark",motionArgs:{forward:!1,linewise:!0}},{keys:"]p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0,matchIndent:!0}},{keys:"[p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0,matchIndent:!0}},{keys:"]<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!0,toJumplist:!0}},{keys:"[<character>",type:"motion",motion:"moveToSymbol",motionArgs:{forward:!1,toJumplist:!0}},{keys:"|",type:"motion",motion:"moveToColumn"},{keys:"o",type:"motion",motion:"moveToOtherHighlightedEnd",context:"visual"},{keys:"O",type:"motion",motion:"moveToOtherHighlightedEnd",motionArgs:{sameLine:!0},context:"visual"},{keys:"d",type:"operator",operator:"delete"},{keys:"y",type:"operator",operator:"yank"},{keys:"c",type:"operator",operator:"change"},{keys:">",type:"operator",operator:"indent",operatorArgs:{indentRight:!0}},{keys:"<",type:"operator",operator:"indent",operatorArgs:{indentRight:!1}},{keys:"g~",type:"operator",operator:"changeCase"},{keys:"gu",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},isEdit:!0},{keys:"gU",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},isEdit:!0},{keys:"n",type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:!0}},{keys:"N",type:"motion",motion:"findNext",motionArgs:{forward:!1,toJumplist:!0}},{keys:"x",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!0},operatorMotionArgs:{visualLine:!1}},{keys:"X",type:"operatorMotion",operator:"delete",motion:"moveByCharacters",motionArgs:{forward:!1},operatorMotionArgs:{visualLine:!0}},{keys:"D",type:"operatorMotion",operator:"delete",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"D",type:"operator",operator:"delete",operatorArgs:{linewise:!0},context:"visual"},{keys:"Y",type:"operatorMotion",operator:"yank",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"Y",type:"operator",operator:"yank",operatorArgs:{linewise:!0},context:"visual"},{keys:"C",type:"operatorMotion",operator:"change",motion:"moveToEol",motionArgs:{inclusive:!0},context:"normal"},{keys:"C",type:"operator",operator:"change",operatorArgs:{linewise:!0},context:"visual"},{keys:"~",type:"operatorMotion",operator:"changeCase",motion:"moveByCharacters",motionArgs:{forward:!0},operatorArgs:{shouldMoveCursor:!0},context:"normal"},{keys:"~",type:"operator",operator:"changeCase",context:"visual"},{keys:"<C-w>",type:"operatorMotion",operator:"delete",motion:"moveByWords",motionArgs:{forward:!1,wordEnd:!1},context:"insert"},{keys:"<C-i>",type:"action",action:"jumpListWalk",actionArgs:{forward:!0}},{keys:"<C-o>",type:"action",action:"jumpListWalk",actionArgs:{forward:!1}},{keys:"<C-e>",type:"action",action:"scroll",actionArgs:{forward:!0,linewise:!0}},{keys:"<C-y>",type:"action",action:"scroll",actionArgs:{forward:!1,linewise:!0}},{keys:"a",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"charAfter"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"eol"},context:"normal"},{keys:"A",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"endOfSelectedArea"},context:"visual"},{keys:"i",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"inplace"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"firstNonBlank"},context:"normal"},{keys:"I",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{insertAt:"startOfSelectedArea"},context:"visual"},{keys:"o",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!0},context:"normal"},{keys:"O",type:"action",action:"newLineAndEnterInsertMode",isEdit:!0,interlaceInsertRepeat:!0,actionArgs:{after:!1},context:"normal"},{keys:"v",type:"action",action:"toggleVisualMode"},{keys:"V",type:"action",action:"toggleVisualMode",actionArgs:{linewise:!0}},{keys:"<C-v>",type:"action",action:"toggleVisualMode",actionArgs:{blockwise:!0}},{keys:"gv",type:"action",action:"reselectLastSelection"},{keys:"J",type:"action",action:"joinLines",isEdit:!0},{keys:"p",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!0,isEdit:!0}},{keys:"P",type:"action",action:"paste",isEdit:!0,actionArgs:{after:!1,isEdit:!0}},{keys:"r<character>",type:"action",action:"replace",isEdit:!0},{keys:"@<character>",type:"action",action:"replayMacro"},{keys:"q<character>",type:"action",action:"enterMacroRecordMode"},{keys:"R",type:"action",action:"enterInsertMode",isEdit:!0,actionArgs:{replace:!0}},{keys:"u",type:"action",action:"undo",context:"normal"},{keys:"u",type:"operator",operator:"changeCase",operatorArgs:{toLower:!0},context:"visual",isEdit:!0},{keys:"U",type:"operator",operator:"changeCase",operatorArgs:{toLower:!1},context:"visual",isEdit:!0},{keys:"<C-r>",type:"action",action:"redo"},{keys:"m<character>",type:"action",action:"setMark"},{keys:'"<character>',type:"action",action:"setRegister"},{keys:"zz",type:"action",action:"scrollToCursor",actionArgs:{position:"center"}},{keys:"z.",type:"action",action:"scrollToCursor",actionArgs:{position:"center"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"zt",type:"action",action:"scrollToCursor",actionArgs:{position:"top"}},{keys:"z<CR>",type:"action",action:"scrollToCursor",actionArgs:{position:"top"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:"z-",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"}},{keys:"zb",type:"action",action:"scrollToCursor",actionArgs:{position:"bottom"},motion:"moveToFirstNonWhiteSpaceCharacter"},{keys:".",type:"action",action:"repeatLastEdit"},{keys:"<C-a>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!0,backtrack:!1}},{keys:"<C-x>",type:"action",action:"incrementNumberToken",isEdit:!0,actionArgs:{increase:!1,backtrack:!1}},{keys:"a<character>",type:"motion",motion:"textObjectManipulation"},{keys:"i<character>",type:"motion",motion:"textObjectManipulation",motionArgs:{textObjectInner:!0}},{keys:"/",type:"search",searchArgs:{forward:!0,querySrc:"prompt",toJumplist:!0}},{keys:"?",type:"search",searchArgs:{forward:!1,querySrc:"prompt",toJumplist:!0}},{keys:"*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",wholeWordOnly:!0,toJumplist:!0}},{keys:"g*",type:"search",searchArgs:{forward:!0,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:"g#",type:"search",searchArgs:{forward:!1,querySrc:"wordUnderCursor",toJumplist:!0}},{keys:":",type:"ex"}],xt=[{name:"colorscheme",shortName:"colo"},{name:"map"},{name:"imap",shortName:"im"},{name:"nmap",shortName:"nm"},{name:"vmap",shortName:"vm"},{name:"unmap"},{name:"write",shortName:"w"},{name:"undo",shortName:"u"},{name:"redo",shortName:"red"},{name:"set",shortName:"se"},{name:"set",shortName:"se"},{name:"setlocal",shortName:"setl"},{name:"setglobal",shortName:"setg"},{name:"sort",shortName:"sor"},{name:"substitute",shortName:"s",possiblyAsync:!0},{name:"nohlsearch",shortName:"noh"},{name:"delmarks",shortName:"delm"},{name:"registers",shortName:"reg",excludeFromCommandHistory:!0},{name:"global",shortName:"g"}],St=yt.Pos,kt=function(){return Kt};yt.defineOption("vimMode",!1,function(e,t,n){t&&"vim"!=e.getOption("keyMap")?e.setOption("keyMap","vim"):!t&&n!=yt.Init&&/^vim/.test(e.getOption("keyMap"))&&e.setOption("keyMap","default")});var $t={Shift:"S",Ctrl:"C",Alt:"A",Cmd:"D",Mod:"A"},Bt={Enter:"CR",Backspace:"BS",Delete:"Del"},Lt=/[\d]/,Dt=[yt.isWordChar,function(e){return e&&!yt.isWordChar(e)&&!/\s/.test(e)}],Mt=[function(e){return/\S/.test(e)}],_t=u(65,26),Rt=u(97,26),Tt=u(48,10),Ot=[].concat(_t,Rt,Tt,["<",">"]),It=[].concat(_t,Rt,Tt,["-",'"',".",":","/"]),Pt={};A("filetype",void 0,"string",["ft"],function(e,t){if(void 0!==t){if(void 0===e){var n=t.getOption("mode");return"null"==n?"":n}var n=""==e?"null":e;t.setOption("mode",n)}});var Wt=function(){function e(e,t,a){function c(t){var o=++i%n,r=s[o];r&&r.clear(),s[o]=e.setBookmark(t)}var l=i%n,h=s[l];if(h){var u=h.find();u&&!V(u,t)&&c(t)}else c(t);c(a),o=i,r=i-n+1,0>r&&(r=0)}function t(e,t){i+=t,i>o?i=o:r>i&&(i=r);var a=s[(n+i)%n];if(a&&!a.find()){var c,l=t>0?1:-1,h=e.getCursor();do if(i+=l,a=s[(n+i)%n],a&&(c=a.find())&&!V(h,c))break;while(o>i&&i>r)}return a}var n=100,i=-1,o=0,r=0,s=new Array(n);return{cachedCursor:void 0,add:e,move:t}},Ht=function(e){return e?{changes:e.changes,expectCursorActivityForChange:e.expectCursorActivityForChange}:{changes:[],expectCursorActivityForChange:!1}};y.prototype={exitMacroRecordMode:function(){var e=Nt.macroModeState;e.onRecordingDone&&e.onRecordingDone(),e.onRecordingDone=void 0,e.isRecording=!1},enterMacroRecordMode:function(e,t){var n=Nt.registerController.getRegister(t);n&&(n.clear(),this.latestRegister=t,e.openDialog&&(this.onRecordingDone=e.openDialog("(recording)["+t+"]",null,{bottom:!0})),this.isRecording=!0)}};var Nt,zt,Kt={buildKeyMap:function(){},getRegisterController:function(){return Nt.registerController},resetVimGlobalState_:F,getVimGlobalState_:function(){return Nt},maybeInitVimState_:E,suppressErrorLogging:!1,InsertModeKey:it,map:function(e,t,n){tn.map(e,t,n)},unmap:function(e,t){tn.unmap(e,t||"normal")},setOption:b,getOption:w,defineOption:A,defineEx:function(e,t,n){if(t){if(0!==e.indexOf(t))throw new Error('(Vim.defineEx) "'+t+'" is not a prefix of "'+e+'", command not registered')}else t=e;en[e]=n,tn.commandMap_[t]={name:e,shortName:t,type:"api"}},handleKey:function(e,t,n){var i=this.findKey(e,t,n);return"function"==typeof i?i():void 0},findKey:function(e,t,n){function i(){var i=Nt.macroModeState;if(i.isRecording){if("q"==t)return i.exitMacroRecordMode(),S(e),!0;"mapping"!=n&&Qe(i,t)}}function o(){return"<Esc>"==t?(S(e),l.visualMode?ce(e):l.insertMode&&je(e),!0):void 0}function r(n){for(var i;n;)i=/<\w+-.+?>|<\w+>|./.exec(n),t=i[0],n=n.substring(i.index+t.length),yt.Vim.handleKey(e,t,"mapping")}function s(){if(o())return!0;for(var n=l.inputState.keyBuffer=l.inputState.keyBuffer+t,i=1==t.length,r=Vt.matchCommand(n,Ft,l.inputState,"insert");n.length>1&&"full"!=r.type;){var n=l.inputState.keyBuffer=n.slice(1),s=Vt.matchCommand(n,Ft,l.inputState,"insert");"none"!=s.type&&(r=s)}if("none"==r.type)return S(e),!1;if("partial"==r.type)return zt&&window.clearTimeout(zt),zt=window.setTimeout(function(){l.insertMode&&l.inputState.keyBuffer&&S(e)},w("insertModeEscKeysTimeout")),!i;if(zt&&window.clearTimeout(zt),i){var a=e.getCursor();e.replaceRange("",I(a,0,-(n.length-1)),a,"+input")}return S(e),r.command}function a(){if(i()||o())return!0;var n=l.inputState.keyBuffer=l.inputState.keyBuffer+t;if(/^[1-9]\d*$/.test(n))return!0;var r=/^(\d*)(.*)$/.exec(n);if(!r)return S(e),!1;var s=l.visualMode?"visual":"normal",a=Vt.matchCommand(r[2]||r[1],Ft,l.inputState,s);if("none"==a.type)return S(e),!1;if("partial"==a.type)return!0;l.inputState.keyBuffer="";var r=/^(\d*)(.*)$/.exec(n);return r[1]&&"0"!=r[1]&&l.inputState.pushRepeatDigit(r[1]),a.command}var c,l=E(e);return c=l.insertMode?s():a(),c===!1?void 0:c===!0?function(){return!0}:function(){return(c.operator||c.isEdit)&&e.getOption("readOnly")?void 0:e.operation(function(){e.curOp.isVimOp=!0;try{"keyToKey"==c.type?r(c.toKeys):Vt.processCommand(e,l,c)}catch(t){throw e.state.vim=void 0,E(e),yt.Vim.suppressErrorLogging||console.log(t),t}return!0})}},handleEx:function(e,t){tn.processCommand(e,t)},defineMotion:D,defineAction:R,defineOperator:_,mapCommand:qe,_mapCommand:Ge,defineRegister:$,exitVisualMode:ce,exitInsertMode:je};x.prototype.pushRepeatDigit=function(e){this.operator?this.motionRepeat=this.motionRepeat.concat(e):this.prefixRepeat=this.prefixRepeat.concat(e)},x.prototype.getRepeat=function(){var e=0;return(this.prefixRepeat.length>0||this.motionRepeat.length>0)&&(e=1,this.prefixRepeat.length>0&&(e*=parseInt(this.prefixRepeat.join(""),10)),this.motionRepeat.length>0&&(e*=parseInt(this.motionRepeat.join(""),10))),e},k.prototype={setText:function(e,t,n){this.keyBuffer=[e||""],this.linewise=!!t,this.blockwise=!!n},pushText:function(e,t){t&&(this.linewise||this.keyBuffer.push("\n"),this.linewise=!0),this.keyBuffer.push(e)},pushInsertModeChanges:function(e){this.insertModeChanges.push(Ht(e))},pushSearchQuery:function(e){this.searchQueries.push(e)},clear:function(){this.keyBuffer=[],this.insertModeChanges=[],this.searchQueries=[],this.linewise=!1},toString:function(){return this.keyBuffer.join("")}},B.prototype={pushText:function(e,t,n,i,o){i&&"\n"==n.charAt(0)&&(n=n.slice(1)+"\n"),i&&"\n"!==n.charAt(n.length-1)&&(n+="\n");var r=this.isValidRegister(e)?this.getRegister(e):null;if(!r){switch(t){case"yank":this.registers[0]=new k(n,i,o);break;case"delete":case"change":-1==n.indexOf("\n")?this.registers["-"]=new k(n,i):(this.shiftNumericRegisters_(),this.registers[1]=new k(n,i))}return void this.unnamedRegister.setText(n,i,o)}var s=m(e);s?r.pushText(n,i):r.setText(n,i,o),this.unnamedRegister.setText(r.toString(),i)},getRegister:function(e){return this.isValidRegister(e)?(e=e.toLowerCase(),this.registers[e]||(this.registers[e]=new k),this.registers[e]):this.unnamedRegister},isValidRegister:function(e){return e&&C(e,It)},shiftNumericRegisters_:function(){for(var e=9;e>=2;e--)this.registers[e]=this.getRegister(""+(e-1))}},L.prototype={nextMatch:function(e,t){var n=this.historyBuffer,i=t?-1:1;null===this.initialPrefix&&(this.initialPrefix=e);for(var o=this.iterator+i;t?o>=0:o<n.length;o+=i)for(var r=n[o],s=0;s<=r.length;s++)if(this.initialPrefix==r.substring(0,s))return this.iterator=o,r;return o>=n.length?(this.iterator=n.length,this.initialPrefix):0>o?e:void 0},pushInput:function(e){var t=this.historyBuffer.indexOf(e);t>-1&&this.historyBuffer.splice(t,1),e.length&&this.historyBuffer.push(e)},reset:function(){this.initialPrefix=null,this.iterator=this.historyBuffer.length}};var Vt={matchCommand:function(e,t,n,i){var o=W(e,t,i,n);if(!o.full&&!o.partial)return{type:"none"};if(!o.full&&o.partial)return{type:"partial"};for(var r,s=0;s<o.full.length;s++){var a=o.full[s];r||(r=a)}return"<character>"==r.keys.slice(-11)&&(n.selectedCharacter=N(e)),{type:"full",command:r}},processCommand:function(e,t,n){switch(t.inputState.repeatOverride=n.repeatOverride,n.type){case"motion":this.processMotion(e,t,n);break;case"operator":this.processOperator(e,t,n);break;case"operatorMotion":this.processOperatorMotion(e,t,n);break;case"action":this.processAction(e,t,n);break;case"search":this.processSearch(e,t,n);break;case"ex":case"keyToEx":this.processEx(e,t,n)}},processMotion:function(e,t,n){t.inputState.motion=n.motion,t.inputState.motionArgs=O(n.motionArgs),this.evalInput(e,t)},processOperator:function(e,t,n){var i=t.inputState;if(i.operator){if(i.operator==n.operator)return i.motion="expandToLine",i.motionArgs={linewise:!0},void this.evalInput(e,t);S(e)}i.operator=n.operator,i.operatorArgs=O(n.operatorArgs),t.visualMode&&this.evalInput(e,t)},processOperatorMotion:function(e,t,n){var i=t.visualMode,o=O(n.operatorMotionArgs);o&&i&&o.visualLine&&(t.visualLine=!0),this.processOperator(e,t,n),i||this.processMotion(e,t,n)},processAction:function(e,t,n){var i=t.inputState,o=i.getRepeat(),r=!!o,s=O(n.actionArgs)||{};i.selectedCharacter&&(s.selectedCharacter=i.selectedCharacter),n.operator&&this.processOperator(e,t,n),n.motion&&this.processMotion(e,t,n),(n.motion||n.operator)&&this.evalInput(e,t),s.repeat=o||1,s.repeatIsExplicit=r,s.registerName=i.registerName,S(e),t.lastMotion=null,n.isEdit&&this.recordLastEdit(t,i,n),Gt[n.action](e,s,t)},processSearch:function(e,t,n){function i(i,o,r){Nt.searchHistoryController.pushInput(i),Nt.searchHistoryController.reset();try{Pe(e,i,o,r)}catch(s){return Re(e,"Invalid regex: "+i),void S(e)}Vt.processMotion(e,t,{type:"motion",motion:"findNext",motionArgs:{forward:!0,toJumplist:n.searchArgs.toJumplist}})}function o(t){e.scrollTo(u.left,u.top),i(t,!0,!0);var n=Nt.macroModeState;n.isRecording&&Xe(n,t)}function r(t,n,i){var o,r=yt.keyName(t);"Up"==r||"Down"==r?(o="Up"==r,n=Nt.searchHistoryController.nextMatch(n,o)||"",i(n)):"Left"!=r&&"Right"!=r&&"Ctrl"!=r&&"Alt"!=r&&"Shift"!=r&&Nt.searchHistoryController.reset();var s;try{s=Pe(e,n,!0,!0)}catch(t){}s?e.scrollIntoView(Ne(e,!a,s),30):(ze(e),e.scrollTo(u.left,u.top))}function s(t,n,i){var o=yt.keyName(t);"Esc"==o||"Ctrl-C"==o||"Ctrl-["==o||"Backspace"==o&&""==n?(Nt.searchHistoryController.pushInput(n),Nt.searchHistoryController.reset(),Pe(e,h),ze(e),e.scrollTo(u.left,u.top),yt.e_stop(t),S(e),i(),e.focus()):"Ctrl-U"==o&&(yt.e_stop(t),i(""))}if(e.getSearchCursor){var a=n.searchArgs.forward,c=n.searchArgs.wholeWordOnly;Se(e).setReversed(!a);var l=a?"/":"?",h=Se(e).getQuery(),u=e.getScrollInfo();switch(n.searchArgs.querySrc){case"prompt":var d=Nt.macroModeState;if(d.isPlaying){var g=d.replaySearchQueries.shift();i(g,!0,!1)}else Oe(e,{onClose:o,prefix:l,desc:Xt,onKeyUp:r,onKeyDown:s});break;case"wordUnderCursor":var p=de(e,!1,!0,!1,!0),f=!0;if(p||(p=de(e,!1,!0,!1,!1),f=!1),!p)return;var g=e.getLine(p.start.line).substring(p.start.ch,p.end.ch);g=f&&c?"\\b"+g+"\\b":J(g),Nt.jumpList.cachedCursor=e.getCursor(),e.setCursor(p.start),i(g,!0,!1)}}},processEx:function(e,t,n){function i(t){Nt.exCommandHistoryController.pushInput(t),Nt.exCommandHistoryController.reset(),tn.processCommand(e,t)}function o(t,n,i){var o,r=yt.keyName(t);("Esc"==r||"Ctrl-C"==r||"Ctrl-["==r||"Backspace"==r&&""==n)&&(Nt.exCommandHistoryController.pushInput(n),Nt.exCommandHistoryController.reset(),yt.e_stop(t),S(e),i(),e.focus()),"Up"==r||"Down"==r?(o="Up"==r,n=Nt.exCommandHistoryController.nextMatch(n,o)||"",i(n)):"Ctrl-U"==r?(yt.e_stop(t),i("")):"Left"!=r&&"Right"!=r&&"Ctrl"!=r&&"Alt"!=r&&"Shift"!=r&&Nt.exCommandHistoryController.reset()}"keyToEx"==n.type?tn.processCommand(e,n.exArgs.input):t.visualMode?Oe(e,{onClose:i,prefix:":",value:"'<,'>",onKeyDown:o}):Oe(e,{onClose:i,prefix:":",onKeyDown:o})},evalInput:function(e,t){var n,i,o,r=t.inputState,s=r.motion,a=r.motionArgs||{},c=r.operator,l=r.operatorArgs||{},h=r.registerName,u=t.sel,d=K(t.visualMode?T(e,u.head):e.getCursor("head")),g=K(t.visualMode?T(e,u.anchor):e.getCursor("anchor")),p=K(d),f=K(g);if(c&&this.recordLastEdit(t,r),o=void 0!==r.repeatOverride?r.repeatOverride:r.getRepeat(),o>0&&a.explicitRepeat?a.repeatIsExplicit=!0:(a.noRepeat||!a.explicitRepeat&&0===o)&&(o=1,a.repeatIsExplicit=!1),r.selectedCharacter&&(a.selectedCharacter=l.selectedCharacter=r.selectedCharacter),a.repeat=o,S(e),s){var m=Ut[s](e,d,a,t);if(t.lastMotion=Ut[s],!m)return;if(a.toJumplist){c||null==e.ace.curOp||(e.ace.curOp.command.scrollIntoView="center-animate");var v=Nt.jumpList,C=v.cachedCursor;C?(ge(e,C,m),delete v.cachedCursor):ge(e,d,m)}m instanceof Array?(i=m[0],n=m[1]):n=m,n||(n=K(d)),t.visualMode?(t.visualBlock&&n.ch===1/0||(n=T(e,n,t.visualBlock)),i&&(i=T(e,i,!0)),i=i||f,u.anchor=i,u.head=n,re(e),be(e,t,"<",U(i,n)?i:n),be(e,t,">",U(i,n)?n:i)):c||(n=T(e,n),e.setCursor(n.line,n.ch))}if(c){if(l.lastSel){i=f;var A=l.lastSel,b=Math.abs(A.head.line-A.anchor.line),w=Math.abs(A.head.ch-A.anchor.ch);n=A.visualLine?St(f.line+b,f.ch):A.visualBlock?St(f.line+b,f.ch+w):A.head.line==A.anchor.line?St(f.line,f.ch+w):St(f.line+b,f.ch),t.visualMode=!0,t.visualLine=A.visualLine,t.visualBlock=A.visualBlock,u=t.sel={anchor:i,head:n},re(e)}else t.visualMode&&(l.lastSel={anchor:K(u.anchor),head:K(u.head),visualBlock:t.visualBlock,visualLine:t.visualLine});var y,E,F,x,k;if(t.visualMode){if(y=j(u.head,u.anchor),E=G(u.head,u.anchor),F=t.visualLine||l.linewise,x=t.visualBlock?"block":F?"line":"char",k=se(e,{anchor:y,head:E},x),F){var $=k.ranges;if("block"==x)for(var B=0;B<$.length;B++)$[B].head.ch=Y(e,$[B].head.line);else"line"==x&&($[0].head=St($[0].head.line+1,0))}}else{if(y=K(i||f),E=K(n||p),U(E,y)){var L=y;y=E,E=L}F=a.linewise||l.linewise,F?he(e,y,E):a.forward&&le(e,y,E),x="char";var D=!a.inclusive||F;k=se(e,{anchor:y,head:E},x,D)}e.setSelections(k.ranges,k.primary),t.lastMotion=null,l.repeat=o,l.registerName=h,l.linewise=F;var M=jt[c](e,l,k.ranges,f,n);t.visualMode&&ce(e,null!=M),M&&e.setCursor(M)}},recordLastEdit:function(e,t,n){var i=Nt.macroModeState;i.isPlaying||(e.lastEditInputState=t,e.lastEditActionCommand=n,i.lastInsertModeChanges.changes=[],i.lastInsertModeChanges.expectCursorActivityForChange=!1)}},Ut={moveToTopLine:function(e,t,n){var i=Ve(e).top+n.repeat-1;return St(i,ue(e.getLine(i)))},moveToMiddleLine:function(e){var t=Ve(e),n=Math.floor(.5*(t.top+t.bottom));return St(n,ue(e.getLine(n)))},moveToBottomLine:function(e,t,n){var i=Ve(e).bottom-n.repeat+1;return St(i,ue(e.getLine(i)))},expandToLine:function(e,t,n){var i=t;return St(i.line+n.repeat-1,1/0)},findNext:function(e,t,n){var i=Se(e),o=i.getQuery();
if(o){var r=!n.forward;return r=i.isReversed()?!r:r,He(e,o),Ne(e,r,o,n.repeat)}},goToMark:function(e,t,n,i){var o=i.marks[n.selectedCharacter];if(o){var r=o.find();return n.linewise?{line:r.line,ch:ue(e.getLine(r.line))}:r}return null},moveToOtherHighlightedEnd:function(e,t,n,i){if(i.visualBlock&&n.sameLine){var o=i.sel;return[T(e,St(o.anchor.line,o.head.ch)),T(e,St(o.head.line,o.anchor.ch))]}return[i.sel.head,i.sel.anchor]},jumpToMark:function(e,t,n,i){for(var o=t,r=0;r<n.repeat;r++){var s=o;for(var a in i.marks)if(g(a)){var c=i.marks[a].find(),l=n.forward?U(c,s):U(s,c);if(!(l||n.linewise&&c.line==s.line)){var h=V(s,o),u=n.forward?q(s,c,o):q(o,c,s);(h||u)&&(o=c)}}}return n.linewise&&(o=St(o.line,ue(e.getLine(o.line)))),o},moveByCharacters:function(e,t,n){var i=t,o=n.repeat,r=n.forward?i.ch+o:i.ch-o;return St(i.line,r)},moveByLines:function(e,t,n,i){var o=t,r=o.ch;switch(i.lastMotion){case this.moveByLines:case this.moveByDisplayLines:case this.moveByScroll:case this.moveToColumn:case this.moveToEol:r=i.lastHPos;break;default:i.lastHPos=r}var s=n.repeat+(n.repeatOffset||0),a=n.forward?o.line+s:o.line-s,c=e.firstLine(),l=e.lastLine();if(!(c>a&&o.line==c||a>l&&o.line==l)){var h=e.ace.session.getFoldLine(a);return h&&(n.forward?a>h.start.row&&(a=h.end.row+1):a=h.start.row),n.toFirstChar&&(r=ue(e.getLine(a)),i.lastHPos=r),i.lastHSPos=e.charCoords(St(a,r),"div").left,St(a,r)}},moveByDisplayLines:function(e,t,n,i){var o=t;switch(i.lastMotion){case this.moveByDisplayLines:case this.moveByScroll:case this.moveByLines:case this.moveToColumn:case this.moveToEol:break;default:i.lastHSPos=e.charCoords(o,"div").left}var r=n.repeat,s=e.findPosV(o,n.forward?r:-r,"line",i.lastHSPos);if(s.hitSide)if(n.forward)var a=e.charCoords(s,"div"),c={top:a.top+8,left:i.lastHSPos},s=e.coordsChar(c,"div");else{var l=e.charCoords(St(e.firstLine(),0),"div");l.left=i.lastHSPos,s=e.coordsChar(l,"div")}return i.lastHPos=s.ch,s},moveByPage:function(e,t,n){var i=t,o=n.repeat;return e.findPosV(i,n.forward?o:-o,"page")},moveByParagraph:function(e,t,n){var i=n.forward?1:-1;return ye(e,t,n.repeat,i)},moveByScroll:function(e,t,n,i){var o=e.getScrollInfo(),r=null,s=n.repeat;s||(s=o.clientHeight/(2*e.defaultTextHeight()));var a=e.charCoords(t,"local");n.repeat=s;var r=Ut.moveByDisplayLines(e,t,n,i);if(!r)return null;var c=e.charCoords(r,"local");return e.scrollTo(null,o.top+c.top-a.top),r},moveByWords:function(e,t,n){return ve(e,t,n.repeat,!!n.forward,!!n.wordEnd,!!n.bigWord)},moveTillCharacter:function(e,t,n){var i=n.repeat,o=Ce(e,i,n.forward,n.selectedCharacter),r=n.forward?-1:1;return pe(r,n),o?(o.ch+=r,o):null},moveToCharacter:function(e,t,n){var i=n.repeat;return pe(0,n),Ce(e,i,n.forward,n.selectedCharacter)||t},moveToSymbol:function(e,t,n){var i=n.repeat;return fe(e,i,n.forward,n.selectedCharacter)||t},moveToColumn:function(e,t,n,i){var o=n.repeat;return i.lastHPos=o-1,i.lastHSPos=e.charCoords(t,"div").left,Ae(e,o)},moveToEol:function(e,t,n,i){var o=t;i.lastHPos=1/0;var r=St(o.line+n.repeat-1,1/0),s=e.clipPos(r);return s.ch--,i.lastHSPos=e.charCoords(s,"div").left,r},moveToFirstNonWhiteSpaceCharacter:function(e,t){var n=t;return St(n.line,ue(e.getLine(n.line)))},moveToMatchedSymbol:function(e,t){var n,i=t,o=i.line,r=i.ch,s=e.getLine(o);do if(n=s.charAt(r++),n&&p(n)){var a=e.getTokenTypeAt(St(o,r));if("string"!==a&&"comment"!==a)break}while(n);if(n){var c=e.findMatchingBracket(St(o,r));return c.to}return i},moveToStartOfLine:function(e,t){return St(t.line,0)},moveToLineOrEdgeOfDocument:function(e,t,n){var i=n.forward?e.lastLine():e.firstLine();return n.repeatIsExplicit&&(i=n.repeat-e.getOption("firstLineNumber")),St(i,ue(e.getLine(i)))},textObjectManipulation:function(e,t,n,i){var o={"(":")",")":"(","{":"}","}":"{","[":"]","]":"["},r={"'":!0,'"':!0},s=n.selectedCharacter;"b"==s?s="(":"B"==s&&(s="{");var a,c=!n.textObjectInner;if(o[s])a=Ee(e,t,s,c);else if(r[s])a=Fe(e,t,s,c);else if("W"===s)a=de(e,c,!0,!0);else if("w"===s)a=de(e,c,!0,!1);else{if("p"!==s)return null;if(a=ye(e,t,n.repeat,0,c),n.linewise=!0,i.visualMode)i.visualLine||(i.visualLine=!0);else{var l=i.inputState.operatorArgs;l&&(l.linewise=!0),a.end.line--}}return e.state.vim.visualMode?oe(e,a.start,a.end):[a.start,a.end]},repeatLastCharacterSearch:function(e,t,n){var i=Nt.lastChararacterSearch,o=n.repeat,r=n.forward===i.forward,s=(i.increment?1:0)*(r?-1:1);e.moveH(-s,"char"),n.inclusive=!!r;var a=Ce(e,o,r,i.selectedCharacter);return a?(a.ch+=s,a):(e.moveH(s,"char"),t)}},jt={change:function(e,t,n){var i,o,r=e.state.vim;if(Nt.macroModeState.lastInsertModeChanges.inVisualBlock=r.visualBlock,r.visualMode){o=e.getSelection();var s=M("",n.length);e.replaceSelections(s),i=j(n[0].head,n[0].anchor)}else{var a=n[0].anchor,c=n[0].head;o=e.getRange(a,c);var l=r.lastEditInputState||{};if("moveByWords"==l.motion&&!v(o)){var h=/\s+$/.exec(o);h&&l.motionArgs&&l.motionArgs.forward&&(c=I(c,0,-h[0].length),o=o.slice(0,-h[0].length))}var u=new St(a.line-1,Number.MAX_VALUE),d=e.firstLine()==e.lastLine();c.line>e.lastLine()&&t.linewise&&!d?e.replaceRange("",u,c):e.replaceRange("",a,c),t.linewise&&(d||(e.setCursor(u),yt.commands.newlineAndIndent(e)),a.ch=Number.MAX_VALUE),i=a}Nt.registerController.pushText(t.registerName,"change",o,t.linewise,n.length>1),Gt.enterInsertMode(e,{head:i},e.state.vim)},"delete":function(e,t,n){var i,o,r=e.state.vim;if(r.visualBlock){o=e.getSelection();var s=M("",n.length);e.replaceSelections(s),i=n[0].anchor}else{var a=n[0].anchor,c=n[0].head;t.linewise&&c.line!=e.firstLine()&&a.line==e.lastLine()&&a.line==c.line-1&&(a.line==e.firstLine()?a.ch=0:a=St(a.line-1,Y(e,a.line-1))),o=e.getRange(a,c),e.replaceRange("",a,c),i=a,t.linewise&&(i=Ut.moveToFirstNonWhiteSpaceCharacter(e,a))}return Nt.registerController.pushText(t.registerName,"delete",o,t.linewise,r.visualBlock),T(e,i)},indent:function(e,t,n){var i=e.state.vim,o=n[0].anchor.line,r=i.visualBlock?n[n.length-1].anchor.line:n[0].head.line,s=i.visualMode?t.repeat:1;t.linewise&&r--;for(var a=o;r>=a;a++)for(var c=0;s>c;c++)e.indentLine(a,t.indentRight);return Ut.moveToFirstNonWhiteSpaceCharacter(e,n[0].anchor)},changeCase:function(e,t,n,i,o){for(var r=e.getSelections(),s=[],a=t.toLower,c=0;c<r.length;c++){var l=r[c],h="";if(a===!0)h=l.toLowerCase();else if(a===!1)h=l.toUpperCase();else for(var u=0;u<l.length;u++){var d=l.charAt(u);h+=m(d)?d.toLowerCase():d.toUpperCase()}s.push(h)}return e.replaceSelections(s),t.shouldMoveCursor?o:!e.state.vim.visualMode&&t.linewise&&n[0].anchor.line+1==n[0].head.line?Ut.moveToFirstNonWhiteSpaceCharacter(e,i):t.linewise?i:j(n[0].anchor,n[0].head)},yank:function(e,t,n,i){var o=e.state.vim,r=e.getSelection(),s=o.visualMode?j(o.sel.anchor,o.sel.head,n[0].head,n[0].anchor):i;return Nt.registerController.pushText(t.registerName,"yank",r,t.linewise,o.visualBlock),s}},Gt={jumpListWalk:function(e,t,n){if(!n.visualMode){var i=t.repeat,o=t.forward,r=Nt.jumpList,s=r.move(e,o?i:-i),a=s?s.find():void 0;a=a?a:e.getCursor(),e.setCursor(a),e.ace.curOp.command.scrollIntoView="center-animate"}},scroll:function(e,t,n){if(!n.visualMode){var i=t.repeat||1,o=e.defaultTextHeight(),r=e.getScrollInfo().top,s=o*i,a=t.forward?r+s:r-s,c=K(e.getCursor()),l=e.charCoords(c,"local");if(t.forward)a>l.top?(c.line+=(a-l.top)/o,c.line=Math.ceil(c.line),e.setCursor(c),l=e.charCoords(c,"local"),e.scrollTo(null,l.top)):e.scrollTo(null,a);else{var h=a+e.getScrollInfo().clientHeight;h<l.bottom?(c.line-=(l.bottom-h)/o,c.line=Math.floor(c.line),e.setCursor(c),l=e.charCoords(c,"local"),e.scrollTo(null,l.bottom-e.getScrollInfo().clientHeight)):e.scrollTo(null,a)}}},scrollToCursor:function(e,t){var n=e.getCursor().line,i=e.charCoords(St(n,0),"local"),o=e.getScrollInfo().clientHeight,r=i.top,s=i.bottom-r;switch(t.position){case"center":r=r-o/2+s;break;case"bottom":r=r-o+1.4*s;break;case"top":r+=.4*s}e.scrollTo(null,r)},replayMacro:function(e,t,n){var i=t.selectedCharacter,o=t.repeat,r=Nt.macroModeState;for("@"==i&&(i=r.latestRegister);o--;)Ye(e,n,r,i)},enterMacroRecordMode:function(e,t){var n=Nt.macroModeState,i=t.selectedCharacter;n.enterMacroRecordMode(e,i)},enterInsertMode:function(e,t,n){if(!e.getOption("readOnly")){n.insertMode=!0,n.insertModeRepeat=t&&t.repeat||1;var i=t?t.insertAt:null,o=n.sel,r=t.head||e.getCursor("head"),s=e.listSelections().length;if("eol"==i)r=St(r.line,Y(e,r.line));else if("charAfter"==i)r=I(r,0,1);else if("firstNonBlank"==i)r=Ut.moveToFirstNonWhiteSpaceCharacter(e,r);else if("startOfSelectedArea"==i)n.visualBlock?(r=St(Math.min(o.head.line,o.anchor.line),Math.min(o.head.ch,o.anchor.ch)),s=Math.abs(o.head.line-o.anchor.line)+1):r=o.head.line<o.anchor.line?o.head:St(o.anchor.line,0);else if("endOfSelectedArea"==i)n.visualBlock?(r=St(Math.min(o.head.line,o.anchor.line),Math.max(o.head.ch+1,o.anchor.ch)),s=Math.abs(o.head.line-o.anchor.line)+1):r=o.head.line>=o.anchor.line?I(o.head,0,1):St(o.anchor.line,0);else if("inplace"==i&&n.visualMode)return;e.setOption("keyMap","vim-insert"),e.setOption("disableInput",!1),t&&t.replace?(e.toggleOverwrite(!0),e.setOption("keyMap","vim-replace"),yt.signal(e,"vim-mode-change",{mode:"replace"})):(e.setOption("keyMap","vim-insert"),yt.signal(e,"vim-mode-change",{mode:"insert"})),Nt.macroModeState.isPlaying||(e.on("change",Ze),yt.on(e.getInputField(),"keydown",ot)),n.visualMode&&ce(e),ee(e,r,s)}},toggleVisualMode:function(e,t,n){var i,o=t.repeat,r=e.getCursor();n.visualMode?n.visualLine^t.linewise||n.visualBlock^t.blockwise?(n.visualLine=!!t.linewise,n.visualBlock=!!t.blockwise,yt.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""}),re(e)):ce(e):(n.visualMode=!0,n.visualLine=!!t.linewise,n.visualBlock=!!t.blockwise,i=T(e,St(r.line,r.ch+o-1),!0),n.sel={anchor:r,head:i},yt.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""}),re(e),be(e,n,"<",j(r,i)),be(e,n,">",G(r,i)))},reselectLastSelection:function(e,t,n){var i=n.lastSelection;if(n.visualMode&&ie(e,n),i){var o=i.anchorMark.find(),r=i.headMark.find();if(!o||!r)return;n.sel={anchor:o,head:r},n.visualMode=!0,n.visualLine=i.visualLine,n.visualBlock=i.visualBlock,re(e),be(e,n,"<",j(o,r)),be(e,n,">",G(o,r)),yt.signal(e,"vim-mode-change",{mode:"visual",subMode:n.visualLine?"linewise":n.visualBlock?"blockwise":""})}},joinLines:function(e,t,n){var i,o;if(n.visualMode){if(i=e.getCursor("anchor"),o=e.getCursor("head"),U(o,i)){var r=o;o=i,i=r}o.ch=Y(e,o.line)-1}else{var s=Math.max(t.repeat,2);i=e.getCursor(),o=T(e,St(i.line+s-1,1/0))}for(var a=0,c=i.line;c<o.line;c++){a=Y(e,i.line);var r=St(i.line+1,Y(e,i.line+1)),l=e.getRange(i,r);l=l.replace(/\n\s*/g," "),e.replaceRange(l,i,r)}var h=St(i.line,a);n.visualMode&&ce(e,!1),e.setCursor(h)},newLineAndEnterInsertMode:function(e,t,n){n.insertMode=!0;var i=K(e.getCursor());if(i.line!==e.firstLine()||t.after){i.line=t.after?i.line:i.line-1,i.ch=Y(e,i.line),e.setCursor(i);var o=yt.commands.newlineAndIndentContinueComment||yt.commands.newlineAndIndent;o(e)}else e.replaceRange("\n",St(e.firstLine(),0)),e.setCursor(e.firstLine(),0);this.enterInsertMode(e,{repeat:t.repeat},n)},paste:function(e,t,n){var i=K(e.getCursor()),o=Nt.registerController.getRegister(t.registerName),r=o.toString();if(r){if(t.matchIndent){var s=e.getOption("tabSize"),a=function(e){var t=e.split("	").length-1,n=e.split(" ").length-1;return t*s+1*n},c=e.getLine(e.getCursor().line),l=a(c.match(/^\s*/)[0]),h=r.replace(/\n$/,""),u=r!==h,d=a(r.match(/^\s*/)[0]),r=h.replace(/^\s*/gm,function(t){var n=l+(a(t)-d);if(0>n)return"";if(e.getOption("indentWithTabs")){var i=Math.floor(n/s);return Array(i+1).join("	")}return Array(n+1).join(" ")});r+=u?"\n":""}if(t.repeat>1)var r=Array(t.repeat+1).join(r);var g=o.linewise,p=o.blockwise;if(g&&!p)n.visualMode?r=n.visualLine?r.slice(0,-1):"\n"+r.slice(0,r.length-1)+"\n":t.after?(r="\n"+r.slice(0,r.length-1),i.ch=Y(e,i.line)):i.ch=0;else{if(p){r=r.split("\n");for(var f=0;f<r.length;f++)r[f]=""==r[f]?" ":r[f]}i.ch+=t.after?1:0}var m,v;if(n.visualMode){n.lastPastedText=r;var C,A=ne(e,n),b=A[0],w=A[1],y=e.getSelection(),E=e.listSelections(),F=new Array(E.length).join("1").split("1");n.lastSelection&&(C=n.lastSelection.headMark.find()),Nt.registerController.unnamedRegister.setText(y),p?(e.replaceSelections(F),w=St(b.line+r.length-1,b.ch),e.setCursor(b),Z(e,w),e.replaceSelections(r),m=b):n.visualBlock?(e.replaceSelections(F),e.setCursor(b),e.replaceRange(r,b,b),m=b):(e.replaceRange(r,b,w),m=e.posFromIndex(e.indexFromPos(b)+r.length-1)),C&&(n.lastSelection.headMark=e.setBookmark(C)),g&&(m.ch=0)}else if(p){e.setCursor(i);for(var f=0;f<r.length;f++){var x=i.line+f;x>e.lastLine()&&e.replaceRange("\n",St(x,0));var S=Y(e,x);S<i.ch&&X(e,x,i.ch)}e.setCursor(i),Z(e,St(i.line+r.length-1,i.ch)),e.replaceSelections(r),m=i}else e.replaceRange(r,i),g&&t.after?m=St(i.line+1,ue(e.getLine(i.line+1))):g&&!t.after?m=St(i.line,ue(e.getLine(i.line))):!g&&t.after?(v=e.indexFromPos(i),m=e.posFromIndex(v+r.length-1)):(v=e.indexFromPos(i),m=e.posFromIndex(v+r.length));n.visualMode&&ce(e,!1),e.setCursor(m)}},undo:function(e,t){e.operation(function(){z(e,yt.commands.undo,t.repeat)(),e.setCursor(e.getCursor("anchor"))})},redo:function(e,t){z(e,yt.commands.redo,t.repeat)()},setRegister:function(e,t,n){n.inputState.registerName=t.selectedCharacter},setMark:function(e,t,n){var i=t.selectedCharacter;be(e,n,i,e.getCursor())},replace:function(e,t,n){var i,o,r=t.selectedCharacter,s=e.getCursor(),a=e.listSelections();if(n.visualMode)s=e.getCursor("start"),o=e.getCursor("end");else{var c=e.getLine(s.line);i=s.ch+t.repeat,i>c.length&&(i=c.length),o=St(s.line,i)}if("\n"==r)n.visualMode||e.replaceRange("",s,o),(yt.commands.newlineAndIndentContinueComment||yt.commands.newlineAndIndent)(e);else{var l=e.getRange(s,o);if(l=l.replace(/[^\n]/g,r),n.visualBlock){var h=new Array(e.getOption("tabSize")+1).join(" ");l=e.getSelection(),l=l.replace(/\t/g,h).replace(/[^\n]/g,r).split("\n"),e.replaceSelections(l)}else e.replaceRange(l,s,o);n.visualMode?(s=U(a[0].anchor,a[0].head)?a[0].anchor:a[0].head,e.setCursor(s),ce(e,!1)):e.setCursor(I(o,0,-1))}},incrementNumberToken:function(e,t){for(var n,i,o,r,s,a=e.getCursor(),c=e.getLine(a.line),l=/-?\d+/g;null!==(n=l.exec(c))&&(s=n[0],i=n.index,o=i+s.length,!(a.ch<o)););if((t.backtrack||!(o<=a.ch))&&s){var h=t.increase?1:-1,u=parseInt(s)+h*t.repeat,d=St(a.line,i),g=St(a.line,o);r=u.toString(),e.replaceRange(r,d,g),e.setCursor(St(a.line,i+r.length-1))}},repeatLastEdit:function(e,t,n){var i=n.lastEditInputState;if(i){var o=t.repeat;o&&t.repeatIsExplicit?n.lastEditInputState.repeatOverride=o:o=n.lastEditInputState.repeatOverride||o,rt(e,n,o,!1)}},exitInsertMode:je},qt={"(":"bracket",")":"bracket","{":"bracket","}":"bracket","[":"section","]":"section","*":"comment","/":"comment",m:"method",M:"method","#":"preprocess"},Yt={bracket:{isComplete:function(e){if(e.nextCh===e.symb){if(e.depth++,e.depth>=1)return!0}else e.nextCh===e.reverseSymb&&e.depth--;return!1}},section:{init:function(e){e.curMoveThrough=!0,e.symb=(e.forward?"]":"[")===e.symb?"{":"}"},isComplete:function(e){return 0===e.index&&e.nextCh===e.symb}},comment:{isComplete:function(e){var t="*"===e.lastCh&&"/"===e.nextCh;return e.lastCh=e.nextCh,t}},method:{init:function(e){e.symb="m"===e.symb?"{":"}",e.reverseSymb="{"===e.symb?"}":"{"},isComplete:function(e){return e.nextCh===e.symb}},preprocess:{init:function(e){e.index=0},isComplete:function(e){if("#"===e.nextCh){var t=e.lineText.match(/#(\w+)/)[1];if("endif"===t){if(e.forward&&0===e.depth)return!0;e.depth++}else if("if"===t){if(!e.forward&&0===e.depth)return!0;e.depth--}if("else"===t&&0===e.depth)return!0}return!1}}};A("pcre",!0,"boolean"),xe.prototype={getQuery:function(){return Nt.query},setQuery:function(e){Nt.query=e},getOverlay:function(){return this.searchOverlay},setOverlay:function(e){this.searchOverlay=e},isReversed:function(){return Nt.isReversed},setReversed:function(e){Nt.isReversed=e},getScrollbarAnnotate:function(){return this.annotate},setScrollbarAnnotate:function(e){this.annotate=e}};var Qt={"\\n":"\n","\\r":"\r","\\t":"	"},Jt={"\\/":"/","\\\\":"\\","\\n":"\n","\\r":"\r","\\t":"	"},Xt="(Javascript regexp)",Zt=function(){this.buildCommandMap_()};Zt.prototype={processCommand:function(e,t,n){var i=this;e.operation(function(){e.curOp.isVimOp=!0,i._processCommand(e,t,n)})},_processCommand:function(e,t,n){var i=e.state.vim,o=Nt.registerController.getRegister(":"),r=o.toString();i.visualMode&&ce(e);var s=new yt.StringStream(t);o.setText(t);var a=n||{};a.input=t;try{this.parseInput_(e,s,a)}catch(c){throw Re(e,c),c}var l,h;if(a.commandName){if(l=this.matchCommand_(a.commandName)){if(h=l.name,l.excludeFromCommandHistory&&o.setText(r),this.parseCommandArgs_(s,a,l),"exToKey"==l.type){for(var u=0;u<l.toKeys.length;u++)yt.Vim.handleKey(e,l.toKeys[u],"mapping");return}if("exToEx"==l.type)return void this.processCommand(e,l.toInput)}}else void 0!==a.line&&(h="move");if(!h)return void Re(e,'Not an editor command ":'+t+'"');try{en[h](e,a),l&&l.possiblyAsync||!a.callback||a.callback()}catch(c){throw Re(e,c),c}},parseInput_:function(e,t,n){t.eatWhile(":"),t.eat("%")?(n.line=e.firstLine(),n.lineEnd=e.lastLine()):(n.line=this.parseLineSpec_(e,t),void 0!==n.line&&t.eat(",")&&(n.lineEnd=this.parseLineSpec_(e,t)));var i=t.match(/^(\w+)/);return i?n.commandName=i[1]:n.commandName=t.match(/.*/)[0],n},parseLineSpec_:function(e,t){var n=t.match(/^(\d+)/);if(n)return parseInt(n[1],10)-1;switch(t.next()){case".":return e.getCursor().line;case"$":return e.lastLine();case"'":var i=e.state.vim.marks[t.next()];if(i&&i.find())return i.find().line;throw new Error("Mark not set");default:return void t.backUp(1)}},parseCommandArgs_:function(e,t,n){if(!e.eol()){t.argString=e.match(/.*/)[0];var i=n.argDelimiter||/\s+/,o=Q(t.argString).split(i);o.length&&o[0]&&(t.args=o)}},matchCommand_:function(e){for(var t=e.length;t>0;t--){var n=e.substring(0,t);if(this.commandMap_[n]){var i=this.commandMap_[n];if(0===i.name.indexOf(e))return i}}return null},buildCommandMap_:function(){this.commandMap_={};for(var e=0;e<xt.length;e++){var t=xt[e],n=t.shortName||t.name;this.commandMap_[n]=t}},map:function(e,t,n){if(":"!=e&&":"==e.charAt(0)){if(n)throw Error("Mode not supported for ex mappings");var i=e.substring(1);":"!=t&&":"==t.charAt(0)?this.commandMap_[i]={name:i,type:"exToEx",toInput:t.substring(1),user:!0}:this.commandMap_[i]={name:i,type:"exToKey",toKeys:t,user:!0}}else if(":"!=t&&":"==t.charAt(0)){var o={keys:e,type:"keyToEx",exArgs:{input:t.substring(1)},user:!0};n&&(o.context=n),Ft.unshift(o)}else{var o={keys:e,type:"keyToKey",toKeys:t,user:!0};n&&(o.context=n),Ft.unshift(o)}},unmap:function(e,t){if(":"!=e&&":"==e.charAt(0)){if(t)throw Error("Mode not supported for ex mappings");var n=e.substring(1);if(this.commandMap_[n]&&this.commandMap_[n].user)return void delete this.commandMap_[n]}else for(var i=e,o=0;o<Ft.length;o++)if(i==Ft[o].keys&&Ft[o].context===t&&Ft[o].user)return void Ft.splice(o,1);throw Error("No such mapping.")}};var en={colorscheme:function(e,t){return!t.args||t.args.length<1?void Re(e,e.getOption("theme")):void e.setOption("theme",t.args[0])},map:function(e,t,n){var i=t.args;return!i||i.length<2?void(e&&Re(e,"Invalid mapping: "+t.input)):void tn.map(i[0],i[1],n)},imap:function(e,t){this.map(e,t,"insert")},nmap:function(e,t){this.map(e,t,"normal")},vmap:function(e,t){this.map(e,t,"visual")},unmap:function(e,t,n){var i=t.args;return!i||i.length<1?void(e&&Re(e,"No such mapping: "+t.input)):void tn.unmap(i[0],n)},move:function(e,t){Vt.processCommand(e,e.state.vim,{type:"motion",motion:"moveToLineOrEdgeOfDocument",motionArgs:{forward:!1,explicitRepeat:!0,linewise:!0},repeatOverride:t.line+1})},set:function(e,t){var n=t.args,i=t.setCfg||{};if(!n||n.length<1)return void(e&&Re(e,"Invalid mapping: "+t.input));var o=n[0].split("="),r=o[0],s=o[1],a=!1;if("?"==r.charAt(r.length-1)){if(s)throw Error("Trailing characters: "+t.argString);r=r.substring(0,r.length-1),a=!0}void 0===s&&"no"==r.substring(0,2)&&(r=r.substring(2),s=!1);var c=Pt[r]&&"boolean"==Pt[r].type;if(c&&void 0==s&&(s=!0),!c&&void 0===s||a){var l=w(r,e,i);l===!0||l===!1?Re(e," "+(l?"":"no")+r):Re(e,"  "+r+"="+l)}else b(r,s,e,i)},setlocal:function(e,t){t.setCfg={scope:"local"},this.set(e,t)},setglobal:function(e,t){t.setCfg={scope:"global"},this.set(e,t)},registers:function(e,t){var n=t.args,i=Nt.registerController.registers,o="----------Registers----------<br><br>";if(n){var r;n=n.join("");for(var s=0;s<n.length;s++)if(r=n.charAt(s),Nt.registerController.isValidRegister(r)){var a=i[r]||new k;o+='"'+r+"    "+a.toString()+"<br>"}}else for(var r in i){var c=i[r].toString();c.length&&(o+='"'+r+"    "+c+"<br>")}Re(e,o)},sort:function(e,t){function n(){if(t.argString){var e=new yt.StringStream(t.argString);if(e.eat("!")&&(o=!0),e.eol())return;if(!e.eatSpace())return"Invalid arguments";var n=e.match(/[a-z]+/);if(n){n=n[0],r=-1!=n.indexOf("i"),s=-1!=n.indexOf("u");var i=-1!=n.indexOf("d")&&1,c=-1!=n.indexOf("x")&&1,l=-1!=n.indexOf("o")&&1;if(i+c+l>1)return"Invalid arguments";a=i&&"decimal"||c&&"hex"||l&&"octal"}if(e.match(/\/.*\//))return"patterns not supported"}}function i(e,t){if(o){var n;n=e,e=t,t=n}r&&(e=e.toLowerCase(),t=t.toLowerCase());var i=a&&p.exec(e),s=a&&p.exec(t);return i?(i=parseInt((i[1]+i[2]).toLowerCase(),f),s=parseInt((s[1]+s[2]).toLowerCase(),f),i-s):t>e?-1:1}var o,r,s,a,c=n();if(c)return void Re(e,c+": "+t.argString);var l=t.line||e.firstLine(),h=t.lineEnd||t.line||e.lastLine();if(l!=h){var u=St(l,0),d=St(h,Y(e,h)),g=e.getRange(u,d).split("\n"),p="decimal"==a?/(-?)([\d]+)/:"hex"==a?/(-?)(?:0x)?([0-9a-f]+)/i:"octal"==a?/([0-7]+)/:null,f="decimal"==a?10:"hex"==a?16:"octal"==a?8:null,m=[],v=[];if(a)for(var C=0;C<g.length;C++)p.exec(g[C])?m.push(g[C]):v.push(g[C]);else v=g;if(m.sort(i),v.sort(i),g=o?m.concat(v):v.concat(m),s){var A,b=g;g=[];for(var C=0;C<b.length;C++)b[C]!=A&&g.push(b[C]),A=b[C]}e.replaceRange(g.join("\n"),u,d)}},global:function(e,t){var n=t.argString;if(!n)return void Re(e,"Regular Expression missing from global");var i,o=void 0!==t.line?t.line:e.firstLine(),r=t.lineEnd||t.line||e.lastLine(),s=$e(n),a=n;if(s.length&&(a=s[0],i=s.slice(1,s.length).join("/")),a)try{Pe(e,a,!0,!0)}catch(c){return void Re(e,"Invalid regex: "+a)}for(var l=Se(e).getQuery(),h=[],u="",d=o;r>=d;d++){var g=l.test(e.getLine(d));g&&(h.push(d+1),u+=e.getLine(d)+"<br>")}if(!i)return void Re(e,u);var p=0,f=function(){if(p<h.length){var t=h[p]+i;tn.processCommand(e,t,{callback:f})}p++};f()},substitute:function(e,t){if(!e.getSearchCursor)throw new Error("Search feature not available. Requires searchcursor.js or any other getSearchCursor implementation.");var n,i,o,r,s=t.argString,a=s?$e(s):[],c="",l=!1,h=!1;if(a.length)n=a[0],c=a[1],void 0!==c&&(c=w("pcre")?Me(c):De(c),Nt.lastSubstituteReplacePart=c),i=a[2]?a[2].split(" "):[];else if(s&&s.length)return void Re(e,"Substitutions should be of the form :s/pattern/replace/");if(i&&(o=i[0],r=parseInt(i[1]),o&&(-1!=o.indexOf("c")&&(l=!0,o.replace("c","")),-1!=o.indexOf("g")&&(h=!0,o.replace("g","")),n=n+"/"+o)),n)try{Pe(e,n,!0,!0)}catch(u){return void Re(e,"Invalid regex: "+n)}if(c=c||Nt.lastSubstituteReplacePart,void 0===c)return void Re(e,"No previous substitute regular expression");var d=Se(e),g=d.getQuery(),p=void 0!==t.line?t.line:e.getCursor().line,f=t.lineEnd||p;p==e.firstLine()&&f==e.lastLine()&&(f=1/0),r&&(p=f,f=p+r-1);var m=T(e,St(p,0)),v=e.getSearchCursor(g,m);Ue(e,l,h,p,f,v,g,c,t.callback)},redo:yt.commands.redo,undo:yt.commands.undo,write:function(e){yt.commands.save?yt.commands.save(e):e.save()},nohlsearch:function(e){ze(e)},delmarks:function(e,t){if(!t.argString||!Q(t.argString))return void Re(e,"Argument required");for(var n=e.state.vim,i=new yt.StringStream(Q(t.argString));!i.eol();){i.eatSpace();var o=i.pos;if(!i.match(/[a-zA-Z]/,!1))return void Re(e,"Invalid argument: "+t.argString.substring(o));var r=i.next();if(i.match("-",!0)){if(!i.match(/[a-zA-Z]/,!1))return void Re(e,"Invalid argument: "+t.argString.substring(o));var s=r,a=i.next();if(!(g(s)&&g(a)||m(s)&&m(a)))return void Re(e,"Invalid argument: "+s+"-");var c=s.charCodeAt(0),l=a.charCodeAt(0);if(c>=l)return void Re(e,"Invalid argument: "+t.argString.substring(o));for(var h=0;l-c>=h;h++){var u=String.fromCharCode(c+h);delete n.marks[u]}}else delete n.marks[r]}}},tn=new Zt;yt.keyMap.vim={attach:a,detach:s,call:c},A("insertModeEscKeysTimeout",200,"number"),yt.keyMap["vim-insert"]={"Ctrl-N":"autocomplete","Ctrl-P":"autocomplete",Enter:function(e){var t=yt.commands.newlineAndIndentContinueComment||yt.commands.newlineAndIndent;t(e)},fallthrough:["default"],attach:a,detach:s,call:c},yt.keyMap["vim-replace"]={Backspace:"goCharLeft",fallthrough:["vim-insert"],attach:a,detach:s,call:c},F(),yt.Vim=kt(),kt=yt.Vim;var nn={"return":"CR",backspace:"BS","delete":"Del",esc:"Esc",left:"Left",right:"Right",up:"Up",down:"Down",space:"Space",home:"Home",end:"End",pageup:"PageUp",pagedown:"PageDown",enter:"CR"},on=kt.handleKey.bind(kt);kt.handleKey=function(e,t,n){return e.operation(function(){return on(e,t,n)},!0)},t.CodeMirror=yt;var rn=kt.maybeInitVimState_;t.handler={$id:"ace/keyboard/vim",drawCursor:function(e,t,n,i,o){var r=this.state.vim||{},s=n.characterWidth,a=n.lineHeight,c=t.top,l=t.left;if(!r.insertMode){var h=i.cursor?ut.comparePoints(i.cursor,i.start)<=0:o.selection.isBackwards()||o.selection.isEmpty();!h&&l>s&&(l-=s)}!r.insertMode&&r.status&&(a/=2,c+=a),e.left=l+"px",e.top=c+"px",e.width=s+"px",e.height=a+"px"},handleKeyboard:function(e,t,n,i,o){var r=e.editor,s=r.state.cm,a=rn(s);if(-1!=i){if("c"==n&&1==t){if(!Ct.isMac&&r.getCopyText())return r.once("copy",function(){r.selection.clearSelection()}),{command:"null",passEvent:!0}}else a.insertMode||Ct.isMac&&this.handleMacRepeat(e,t,n)&&(t=-1,n=e.inputChar);if(-1==t||1&t||0===t&&n.length>1){var c=a.insertMode,l=at(t,n,o||{});null==a.status&&(a.status="");var h=lt(s,l,"user");if(a=rn(s),h&&null!=a.status?a.status+=l:null==a.status&&(a.status=""),s._signal("changeStatus"),!h&&(-1!=t||c))return;return{command:"null",passEvent:!h}}}},attach:function(e){e.state||(e.state={});var t=new yt(e);e.state.cm=t,e.$vimModeHandler=this,yt.keyMap.vim.attach(t),rn(t).status=null,t.on("vim-command-done",function(){t.virtualSelectionMode()||(rn(t).status=null,t.ace._signal("changeStatus"),t.ace.session.markUndoGroup())}),t.on("changeStatus",function(){t.ace.renderer.updateCursor(),t.ace._signal("changeStatus")}),t.on("vim-mode-change",function(){t.virtualSelectionMode()||(t.ace.renderer.setStyle("normal-mode",!rn(t).insertMode),t._signal("changeStatus"))}),t.ace.renderer.setStyle("normal-mode",!rn(t).insertMode),e.renderer.$cursorLayer.drawCursor=this.drawCursor.bind(t),this.updateMacCompositionHandlers(e,!0)},detach:function(e){var t=e.state.cm;yt.keyMap.vim.detach(t),t.destroy(),e.state.cm=null,e.$vimModeHandler=null,e.renderer.$cursorLayer.drawCursor=null,e.renderer.setStyle("normal-mode",!1),this.updateMacCompositionHandlers(e,!1)},getStatusText:function(e){var t=e.state.cm,n=rn(t);if(n.insertMode)return"INSERT";var i="";return n.visualMode&&(i+="VISUAL",n.visualLine&&(i+=" LINE"),n.visualBlock&&(i+=" BLOCK")),n.status&&(i+=(i?" ":"")+n.status),i},handleMacRepeat:function(e,t,n){if(-1==t)e.inputChar=n,e.lastEvent="input";else if(e.inputChar&&e.$lastHash==t&&e.$lastKey==n){if("input"==e.lastEvent)e.lastEvent="input1";else if("input1"==e.lastEvent)return!0}else e.$lastHash=t,e.$lastKey=n,e.lastEvent="keypress"},updateMacCompositionHandlers:function(e,t){var n=function(t){var n=e.state.cm,i=rn(n);if(i.insertMode)this.onCompositionUpdateOrig(t);else{var o=this.textInput.getElement();o.blur(),o.focus(),o.value=t}},i=function(t){var n=e.state.cm,i=rn(n);i.insertMode||this.onCompositionStartOrig(t)};t?e.onCompositionUpdateOrig||(e.onCompositionUpdateOrig=e.onCompositionUpdate,e.onCompositionUpdate=n,e.onCompositionStartOrig=e.onCompositionStart,e.onCompositionStart=i):e.onCompositionUpdateOrig&&(e.onCompositionUpdate=e.onCompositionUpdateOrig,e.onCompositionUpdateOrig=null,e.onCompositionStart=e.onCompositionStartOrig,e.onCompositionStartOrig=null)}};kt.defineOption({name:"wrap",set:function(e,t){t&&t.ace.setOption("wrap",e)},type:"boolean"},!1),kt.defineEx("write","w",function(){console.log(":write is not implemented")}),Ft.push({keys:"zc",type:"action",action:"fold",actionArgs:{open:!1}},{keys:"zC",type:"action",action:"fold",actionArgs:{open:!1,all:!0}},{keys:"zo",type:"action",action:"fold",actionArgs:{open:!0}},{keys:"zO",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"za",type:"action",action:"fold",actionArgs:{toggle:!0}},{keys:"zA",type:"action",action:"fold",actionArgs:{toggle:!0,all:!0}},{keys:"zf",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"zd",type:"action",action:"fold",actionArgs:{open:!0,all:!0}},{keys:"<C-A-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAbove"}},{keys:"<C-A-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelow"}},{keys:"<C-A-S-k>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorAboveSkipCurrent"}},{keys:"<C-A-S-j>",type:"action",action:"aceCommand",actionArgs:{name:"addCursorBelowSkipCurrent"}},{keys:"<C-A-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreBefore"}},{keys:"<C-A-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectMoreAfter"}},{keys:"<C-A-S-h>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextBefore"}},{keys:"<C-A-S-l>",type:"action",action:"aceCommand",actionArgs:{name:"selectNextAfter"}}),Gt.aceCommand=function(e,t){e.vimCmd=t,e.ace.inVirtualSelectionMode?e.ace.on("beforeEndOperation",ht):ht(null,e.ace)},Gt.fold=function(e,t){e.ace.execCommand(["toggleFoldWidget","toggleFoldWidget","foldOther","unfoldall"][(t.all?2:0)+(t.open?1:0)])},t.handler.defaultKeymap=Ft,t.handler.actions=Gt,t.Vim=kt,kt.map("Y","yy","normal")});